import{_ as n,o as a,c as s,e as t}from"./app-B8gNu4K5.js";const p="/images/dynamictp/spi-wrapper.png",e={},l=t(`<h3 id="任务包装器" tabindex="-1"><a class="header-anchor" href="#任务包装器"><span>任务包装器</span></a></h3><p>框架默认提供了一些任务包装器，可以实现特定的功能</p><div class="hint-container tip"><p class="hint-container-title">任务包装器</p><ul><li><p>MdcTaskWrapper 支持 MDC 上下文传递，名称：mdc</p></li><li><p>TtlTaskWrapper 支持 ThreadLocal 上下文传递，名称：ttl</p></li><li><p>SwTraceTaskWrapper 支持 Skywalking TID 传递，名称：swTrace</p></li><li><p>OpenTelemetryWrapper，支持 OpenTelemetry 上下文传递，名称：OTel</p></li><li><p>NamedRunnable 支持给任务添加名称</p></li><li><p>可以继承 TaskWrapper SPI 接口自定义任务包装器</p></li></ul></div><h3 id="使用方式" tabindex="-1"><a class="header-anchor" href="#使用方式"><span>使用方式</span></a></h3><ol><li><p>MdcTaskWrapper、TtlTaskWrapper、NamedRunnable 在 core 包中，不需要引入其他依赖</p></li><li><p>SwTraceTaskWrapper 是 extension 模块提供的扩展，需要引入依赖</p></li></ol><p>SpringBoot1x、2x、Spring5x 用此依赖</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.dromara.dynamictp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>dynamic-tp-extension-skywalking<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SpringBoot3x、Spring6x 用此依赖</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.dromara.dynamictp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>dynamic-tp-extension-skywalking<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.0-x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>OpenTelemetryWrapper 是 extension 模块提供的扩展，需要引入依赖</li></ol><p>SpringBoot1x、2x、Spring5x 用此依赖</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.dromara.dynamictp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>dynamic-tp-extension-opentelemetry<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SpringBoot3x、Spring6x 用此依赖</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.dromara.dynamictp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>dynamic-tp-extension-opentelemetry<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.0-x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>自定义 TaskWrapper 示例</li></ol><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>dromara<span class="token punctuation">.</span>dynamictp<span class="token punctuation">.</span>example<span class="token punctuation">.</span>wrapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>dromara<span class="token punctuation">.</span>dynamictp<span class="token punctuation">.</span>core<span class="token punctuation">.</span>support<span class="token punctuation">.</span>task<span class="token punctuation">.</span>wrapper<span class="token punctuation">.</span></span><span class="token class-name">TaskWrapper</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * CustomTaskWrapper related
 *
 * <span class="token keyword">@author</span> yanhom
 * <span class="token keyword">@since</span> 1.1.0
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomTaskWrapper</span> <span class="token keyword">implements</span> <span class="token class-name">TaskWrapper</span> <span class="token punctuation">{</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;custom&quot;</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">Runnable</span> <span class="token function">wrap</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> runnable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyRunnable</span><span class="token punctuation">(</span>runnable<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>

      <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Runnable</span> runnable<span class="token punctuation">;</span>

      <span class="token keyword">public</span> <span class="token class-name">MyRunnable</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> runnable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>runnable <span class="token operator">=</span> runnable<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token annotation punctuation">@Override</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;before run&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         runnable<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;after run&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>resources/META-INF/services 下配置 java spi 实现</p><p>文件名：org.dromara.dynamictp.core.support.task.wrapper.TaskWrapper</p><p>文件值：org.dromara.dynamictp.example.wrapper.CustomTaskWrapper</p><figure><img src="`+p+`" alt="图片.png" tabindex="0" loading="lazy"><figcaption>图片.png</figcaption></figure><ol start="5"><li>线程池配置文件加如下配置项</li></ol><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">dynamictp</span><span class="token punctuation">:</span>
  <span class="token key atrule">executors</span><span class="token punctuation">:</span>                                         <span class="token comment"># 动态线程池配置，省略其他项，具体看上述配置文件</span>
    <span class="token punctuation">-</span> <span class="token key atrule">threadPoolName</span><span class="token punctuation">:</span> dtpExecutor1
      <span class="token key atrule">taskWrapperNames</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;ttl&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;mdc&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;swTrace&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;custom&quot;</span><span class="token punctuation">]</span>    <span class="token comment"># 任务包装器名称，继承 TaskWrapper 接口</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,22),c=[l];function o(i,u){return a(),s("div",null,c)}const d=n(e,[["render",o],["__file","wrapper.html.vue"]]),k=JSON.parse('{"path":"/guide/use/wrapper.html","title":"任务包装","lang":"zh-CN","frontmatter":{"title":"任务包装","icon":"wrapper1","order":1,"author":"yanhom","date":"2022-08-15T00:00:00.000Z","tag":["任务包装","dynamictp"],"sticky":true,"star":true,"description":"任务包装器 框架默认提供了一些任务包装器，可以实现特定的功能 任务包装器 MdcTaskWrapper 支持 MDC 上下文传递，名称：mdc TtlTaskWrapper 支持 ThreadLocal 上下文传递，名称：ttl SwTraceTaskWrapper 支持 Skywalking TID 传递，名称：swTrace OpenTelemet...","head":[["meta",{"property":"og:url","content":"https://gitee.com/dromara/dynamic-tp/guide/use/wrapper.html"}],["meta",{"property":"og:site_name","content":"dynamictp"}],["meta",{"property":"og:title","content":"任务包装"}],["meta",{"property":"og:description","content":"任务包装器 框架默认提供了一些任务包装器，可以实现特定的功能 任务包装器 MdcTaskWrapper 支持 MDC 上下文传递，名称：mdc TtlTaskWrapper 支持 ThreadLocal 上下文传递，名称：ttl SwTraceTaskWrapper 支持 Skywalking TID 传递，名称：swTrace OpenTelemet..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://gitee.com/dromara/dynamic-tp/images/dynamictp/spi-wrapper.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-03-15T15:33:45.000Z"}],["meta",{"property":"article:author","content":"yanhom"}],["meta",{"property":"article:tag","content":"任务包装"}],["meta",{"property":"article:tag","content":"dynamictp"}],["meta",{"property":"article:published_time","content":"2022-08-15T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-03-15T15:33:45.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"任务包装\\",\\"image\\":[\\"https://gitee.com/dromara/dynamic-tp/images/dynamictp/spi-wrapper.png\\"],\\"datePublished\\":\\"2022-08-15T00:00:00.000Z\\",\\"dateModified\\":\\"2025-03-15T15:33:45.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"yanhom\\"}]}"]]},"headers":[{"level":3,"title":"任务包装器","slug":"任务包装器","link":"#任务包装器","children":[]},{"level":3,"title":"使用方式","slug":"使用方式","link":"#使用方式","children":[]}],"git":{"createdTime":1677489312000,"updatedTime":1742052825000,"contributors":[{"name":"yanhom","email":"yanhom1314@foxmail.com","commits":20}]},"readingTime":{"minutes":1.41,"words":424},"filePathRelative":"guide/use/wrapper.md","localizedDate":"2022年8月15日","autoDesc":true,"excerpt":"<h3>任务包装器</h3>\\n<p>框架默认提供了一些任务包装器，可以实现特定的功能</p>\\n<div class=\\"hint-container tip\\">\\n<p class=\\"hint-container-title\\">任务包装器</p>\\n<ul>\\n<li>\\n<p>MdcTaskWrapper 支持 MDC 上下文传递，名称：mdc</p>\\n</li>\\n<li>\\n<p>TtlTaskWrapper 支持 ThreadLocal 上下文传递，名称：ttl</p>\\n</li>\\n<li>\\n<p>SwTraceTaskWrapper 支持 Skywalking TID 传递，名称：swTrace</p>\\n</li>\\n<li>\\n<p>OpenTelemetryWrapper，支持 OpenTelemetry 上下文传递，名称：OTel</p>\\n</li>\\n<li>\\n<p>NamedRunnable 支持给任务添加名称</p>\\n</li>\\n<li>\\n<p>可以继承 TaskWrapper SPI 接口自定义任务包装器</p>\\n</li>\\n</ul>\\n</div>"}');export{d as comp,k as data};
