<template><div><p>ä½ è¿˜åœ¨ä¸º RocketMq æ¶ˆè´¹ç§¯å‹è€Œçƒ¦æ¼å—ï¼ŸğŸ˜­ğŸ˜­ğŸ˜­</p>
<p>å¿«å¿«ä½¿ç”¨ DynamicTp çš„ä¸‰æ–¹ä¸­é—´ä»¶çº¿ç¨‹æ± ç®¡ç†åŠŸèƒ½å§ï¼Œä¸€å®šç¨‹åº¦ä¸Šèƒ½å‡å°‘ä½ çš„çƒ¦æ¼ã€‚ğŸ˜…ğŸ˜…ğŸ˜…</p>
<h3 id="ä½¿ç”¨æ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨æ­¥éª¤" aria-hidden="true">#</a> ä½¿ç”¨æ­¥éª¤</h3>
<ol>
<li>å¼•å…¥ä¸‹è¿°ä¾èµ–</li>
</ol>
<p>SpringBoot1xã€2x ç”¨æ­¤ä¾èµ–</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><pre v-pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.dromara.dynamictp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>dynamic-tp-spring-boot-starter-adapter-rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.1.6.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SpringBoot3x ç”¨æ­¤ä¾èµ–</p>
<div class="language-xml line-numbers-mode" data-ext="xml"><pre v-pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.dromara.dynamictp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>dynamic-tp-spring-boot-starter-adapter-rocketmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.1.6.1-3.x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2">
<li>é…ç½®æ–‡ä»¶ä¸­é…ç½® rocketmq çº¿ç¨‹æ± </li>
</ol>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">dynamic</span><span class="token punctuation">:</span>
    <span class="token key atrule">tp</span><span class="token punctuation">:</span>
      <span class="token key atrule">enabledCollect</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>          <span class="token comment"># æ˜¯å¦å¼€å¯ç›‘æ§æŒ‡æ ‡é‡‡é›†ï¼Œé»˜è®¤false</span>
      <span class="token key atrule">collectorTypes</span><span class="token punctuation">:</span> micrometer    <span class="token comment"># ç›‘æ§æ•°æ®é‡‡é›†å™¨ç±»å‹ï¼ˆlogging | micrometer | internal_logging | JMXï¼‰ï¼Œé»˜è®¤micrometer</span>
      <span class="token key atrule">monitorInterval</span><span class="token punctuation">:</span> <span class="token number">5</span>            <span class="token comment"># ç›‘æ§æ—¶é—´é—´éš”ï¼ˆæŠ¥è­¦åˆ¤æ–­ã€æŒ‡æ ‡é‡‡é›†ï¼‰ï¼Œé»˜è®¤5s</span>
      <span class="token key atrule">rocketMqTp</span><span class="token punctuation">:</span>                                  <span class="token comment"># rocketmq çº¿ç¨‹æ± é…ç½®</span>
        <span class="token punctuation">-</span> <span class="token key atrule">threadPoolName</span><span class="token punctuation">:</span> rocketMqTp<span class="token comment">#consumer#concurrently#group    # åç§°è§„åˆ™ï¼šrocketMqTp#consumer#concurrently#group</span>
          <span class="token key atrule">corePoolSize</span><span class="token punctuation">:</span> <span class="token number">200</span>
          <span class="token key atrule">maximumPoolSize</span><span class="token punctuation">:</span> <span class="token number">200</span>
          <span class="token key atrule">keepAliveTime</span><span class="token punctuation">:</span> <span class="token number">60</span>
          <span class="token key atrule">runTimeout</span><span class="token punctuation">:</span> <span class="token number">200</span>                              
          <span class="token key atrule">queueTimeout</span><span class="token punctuation">:</span> <span class="token number">100</span>
          <span class="token key atrule">platformIds</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>               <span class="token comment"># é€šçŸ¥æŠ¥è­¦å¹³å°idï¼Œä¸é…ç½®é»˜è®¤æ‹¿ä¸Šå±‚platformsé…ç½®çš„æ‰€æœ‰å¹³å°</span>
          <span class="token key atrule">notifyItems</span><span class="token punctuation">:</span>                     <span class="token comment"># æŠ¥è­¦é¡¹ï¼Œä¸é…ç½®è‡ªåŠ¨ä¼šæŒ‰é»˜è®¤å€¼é…ç½®ï¼ˆå˜æ›´é€šçŸ¥ã€å®¹é‡æŠ¥è­¦ã€æ´»æ€§æŠ¥è­¦ã€æ‹’ç»æŠ¥è­¦ã€ä»»åŠ¡è¶…æ—¶æŠ¥è­¦ï¼‰</span>
            <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> change
              <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

            <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> capacity               <span class="token comment"># é˜Ÿåˆ—å®¹é‡ä½¿ç”¨ç‡ï¼ŒæŠ¥è­¦é¡¹ç±»å‹ï¼ŒæŸ¥çœ‹æºç  NotifyTypeEnumæšä¸¾ç±»</span>
              <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
              <span class="token key atrule">threshold</span><span class="token punctuation">:</span> <span class="token number">80</span>                <span class="token comment"># æŠ¥è­¦é˜ˆå€¼ï¼Œé»˜è®¤70ï¼Œæ„æ€æ˜¯é˜Ÿåˆ—ä½¿ç”¨ç‡è¾¾åˆ°70%å‘Šè­¦</span>
              <span class="token key atrule">platformIds</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>             <span class="token comment"># å¯é€‰é…ç½®ï¼Œæœ¬é…ç½®ä¼˜å…ˆçº§ > æ‰€å±çº¿ç¨‹æ± platformIds > å…¨å±€é…ç½®platforms</span>
              <span class="token key atrule">interval</span><span class="token punctuation">:</span> <span class="token number">120</span>                <span class="token comment"># æŠ¥è­¦é—´éš”ï¼ˆå•ä½ï¼šsï¼‰ï¼Œé»˜è®¤120</span>

            <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> liveness               <span class="token comment"># çº¿ç¨‹æ± æ´»æ€§</span>
              <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
              <span class="token key atrule">threshold</span><span class="token punctuation">:</span> <span class="token number">80</span>                <span class="token comment"># æŠ¥è­¦é˜ˆå€¼ï¼Œé»˜è®¤ 70ï¼Œæ„æ€æ˜¯æ´»æ€§è¾¾åˆ°70%å‘Šè­¦</span>

            <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> reject                 <span class="token comment"># è§¦å‘ä»»åŠ¡æ‹’ç»å‘Šè­¦</span>
              <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
              <span class="token key atrule">threshold</span><span class="token punctuation">:</span> <span class="token number">100</span>               <span class="token comment"># é»˜è®¤é˜ˆå€¼10</span>

            <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> run_timeout            <span class="token comment"># ä»»åŠ¡æ‰§è¡Œè¶…æ—¶å‘Šè­¦</span>
              <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
              <span class="token key atrule">threshold</span><span class="token punctuation">:</span> <span class="token number">100</span>               <span class="token comment"># é»˜è®¤é˜ˆå€¼10</span>

            <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> queue_timeout          <span class="token comment"># ä»»åŠ¡æ’é˜Ÿè¶…æ—¶å‘Šè­¦</span>
              <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
              <span class="token key atrule">threshold</span><span class="token punctuation">:</span> <span class="token number">100</span>               <span class="token comment"># é»˜è®¤é˜ˆå€¼10</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3">
<li>å¯åŠ¨æ—¥å¿—</li>
</ol>
<p>æœåŠ¡å¯åŠ¨çœ‹åˆ°æœ‰å¦‚ä¸‹æ—¥å¿—è¾“å‡ºè¯´æ˜æ¥å…¥æˆåŠŸï¼Œå¦‚æœå¼€å¯äº†é€šçŸ¥ï¼ŒåŒæ—¶ä¼šæ¨é€å‚æ•°ä¿®æ”¹é€šçŸ¥</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code>DynamicTp adapter, rocketMq consumer executors init end, executors: <span class="token punctuation">{</span>group<span class="token comment">#topic=ExecutorWrapper(threadPoolName=rocketMqTp#consumer#concurrently#sms, executor=java.util.concurrent.ThreadPoolExecutor@1acd1f1[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0], threadPoolAliasName=null, notifyItems=[NotifyItem(platforms=null, enabled=true, type=liveness, threshold=70, interval=120, clusterLimit=1), NotifyItem(platforms=null, enabled=true, type=change, threshold=0, interval=1, clusterLimit=1), NotifyItem(platforms=null, enabled=true, type=capacity, threshold=70, interval=120, clusterLimit=1)], notifyEnabled=true)}</span>
DynamicTp rocketMqTp adapter, <span class="token punctuation">[</span>rocketMqTp<span class="token comment">#consumer#concurrently#sms] refreshed end, changed keys: [corePoolSize, maxPoolSize], corePoolSize: [20 => 200], maxPoolSize: [20 => 200], keepAliveTime: [60 => 60]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip">
<p class="hint-container-title">æç¤º</p>
<ol>
<li>çº¿ç¨‹æ± åç§°è§„åˆ™ï¼šrocketMqTp#consumer#concurrently#groupï¼ˆå¯ä»¥åœ¨å¯åŠ¨æ—¥å¿—æ‰¾è¾“å‡ºçš„çº¿ç¨‹æ± åç§°ï¼‰</li>
<li>rocketmq çº¿ç¨‹æ± äº«æœ‰åŠ¨æ€è°ƒå‚ã€ç›‘æ§ã€é€šçŸ¥å‘Šè­¦å®Œæ•´çš„åŠŸèƒ½</li>
</ol>
</div>
</div></template>


