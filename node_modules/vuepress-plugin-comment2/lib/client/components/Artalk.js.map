{"version":3,"file":"Artalk.js","sources":["../../../src/client/components/Artalk.ts"],"sourcesContent":["import { usePageData, usePageFrontmatter, useSiteData } from \"@vuepress/client\";\nimport type Artalk from \"artalk\";\nimport {\n  type VNode,\n  computed,\n  defineComponent,\n  h,\n  nextTick,\n  onMounted,\n  ref,\n  watch,\n} from \"vue\";\n\nimport {\n  type ArtalkOptions,\n  type CommentPluginFrontmatter,\n} from \"../../shared/index.js\";\n\nimport \"artalk/dist/Artalk.css\";\nimport \"../styles/artalk.scss\";\n\ndeclare const COMMENT_OPTIONS: ArtalkOptions;\n\nconst artalkOptions = COMMENT_OPTIONS;\n\nconst enableArtalk = Boolean(artalkOptions.server);\n\nexport default defineComponent({\n  // eslint-disable-next-line vue/multi-word-component-names\n  name: \"Artalk\",\n\n  props: {\n    /**\n     * Whether the component is in darkmode\n     *\n     * 组件是否处于夜间模式\n     */\n    darkmode: Boolean,\n  },\n\n  setup: (props) => {\n    const frontmatter = usePageFrontmatter<CommentPluginFrontmatter>();\n    const page = usePageData();\n    const site = useSiteData();\n\n    const artalkContainer = ref<HTMLDivElement>();\n\n    let artalk: Artalk.default | null = null;\n\n    const enableComment = computed(() => {\n      if (!enableArtalk) return false;\n      const pluginConfig = artalkOptions.comment !== false;\n      const pageConfig = frontmatter.value.comment;\n\n      return (\n        // Enable in page\n        Boolean(pageConfig) ||\n        // not disabled in anywhere\n        (pluginConfig !== false && pageConfig !== false)\n      );\n    });\n\n    const initArtalk = async (): Promise<void> => {\n      if (enableComment.value)\n        await Promise.all([\n          import(/* webpackChunkName: \"artalk\" */ \"artalk\"),\n          new Promise<void>((resolve) => {\n            setTimeout(() => {\n              void nextTick().then(resolve);\n            }, artalkOptions.delay);\n          }),\n        ]).then(([{ default: _Artalk }]) => {\n          // FIXME: Typescript type issues\n          const Artalk = _Artalk as unknown as typeof _Artalk.default;\n\n          try {\n            artalk = new Artalk({\n              useBackendConf: false,\n              site: site.value.title,\n              pageTitle: page.value.title,\n              ...artalkOptions,\n              el: artalkContainer.value!,\n              pageKey: page.value.path,\n              darkMode: props.darkmode,\n            });\n\n            if (artalkOptions.useBackendConf)\n              artalk.on(\"conf-loaded\", () => {\n                artalk!.setDarkMode(props.darkmode);\n              });\n          } catch (err) {\n            // FIXME: Not sure what the issue is, relevant issue:\n            // https://github.com/vuepress/vuepress-next/issues/1249\n            // https://github.com/ArtalkJS/Artalk/discussions/367\n          }\n        });\n    };\n\n    onMounted(() => {\n      watch(\n        () => [enableComment.value, page.value.path],\n        () => initArtalk(),\n        { immediate: true }\n      );\n\n      watch(\n        () => props.darkmode,\n        (value) => {\n          artalk?.setDarkMode(value);\n        }\n      );\n    });\n\n    return (): VNode | null =>\n      enableComment.value\n        ? h(\n            \"div\",\n            { class: \"artalk-wrapper\" },\n            h(\"div\", { ref: artalkContainer })\n          )\n        : null;\n  },\n});\n"],"names":["artalkOptions","enableArtalk","Artalk","defineComponent","props","frontmatter","usePageFrontmatter","page","usePageData","site","useSiteData","artalkContainer","ref","artalk","enableComment","computed","pluginConfig","pageConfig","initArtalk","resolve","nextTick","_Artalk","onMounted","watch","value","h"],"mappings":"iQAuBA,MAAMA,EAAgB,gBAEhBC,EAAe,CAAQD,CAAAA,EAAc,OAE3C,IAAAE,EAAeC,EAAgB,CAE7B,KAAM,SAEN,MAAO,CAML,SAAU,OACZ,EAEA,MAAQC,GAAU,CAChB,MAAMC,EAAcC,EAA6C,EAC3DC,EAAOC,EAAAA,EACPC,EAAOC,EAAY,EAEnBC,EAAkBC,EAAAA,EAExB,IAAIC,EAAgC,KAEpC,MAAMC,EAAgBC,EAAS,IAAM,CACnC,GAAI,CAACd,EAAc,MAAO,GAC1B,MAAMe,EAAehB,EAAc,UAAY,GACzCiB,EAAaZ,EAAY,MAAM,QAErC,MAEE,CAAQY,CAAAA,GAEPD,IAAiB,IAASC,IAAe,EAE9C,CAAC,EAEKC,EAAa,SAA2B,CACxCJ,EAAc,OAChB,MAAM,QAAQ,IAAI,CAChB,OAAwC,QAAQ,EAChD,IAAI,QAAeK,GAAY,CAC7B,WAAW,IAAM,CACVC,EAAS,EAAE,KAAKD,CAAO,CAC9B,EAAGnB,EAAc,KAAK,CACxB,CAAC,CACH,CAAC,EAAE,KAAK,CAAC,CAAC,CAAE,QAASqB,CAAQ,CAAC,IAAM,CAElC,MAAMnB,EAASmB,EAEf,GAAI,CACFR,EAAS,IAAIX,EAAO,CAClB,eAAgB,GAChB,KAAMO,EAAK,MAAM,MACjB,UAAWF,EAAK,MAAM,MACtB,GAAGP,EACH,GAAIW,EAAgB,MACpB,QAASJ,EAAK,MAAM,KACpB,SAAUH,EAAM,QAClB,CAAC,EAEGJ,EAAc,gBAChBa,EAAO,GAAG,cAAe,IAAM,CAC7BA,EAAQ,YAAYT,EAAM,QAAQ,CACpC,CAAC,CACL,MAAE,CAAA,CAKJ,CAAC,CACL,EAEA,OAAAkB,EAAU,IAAM,CACdC,EACE,IAAM,CAACT,EAAc,MAAOP,EAAK,MAAM,IAAI,EAC3C,IAAMW,EAAW,EACjB,CAAE,UAAW,EAAK,CACpB,EAEAK,EACE,IAAMnB,EAAM,SACXoB,GAAU,CACTX,GAAA,MAAAA,EAAQ,YAAYW,CACtB,CAAA,CACF,CACF,CAAC,EAEM,IACLV,EAAc,MACVW,EACE,MACA,CAAE,MAAO,gBAAiB,EAC1BA,EAAE,MAAO,CAAE,IAAKd,CAAgB,CAAC,CACnC,EACA,IACR,CACF,CAAC"}