{"version":3,"file":"Giscus.js","sources":["../../../src/client/components/Giscus.ts"],"sourcesContent":["import {\n  usePageData,\n  usePageFrontmatter,\n  usePageLang,\n  withBase,\n} from \"@vuepress/client\";\nimport { type VNode, computed, defineComponent, h, onMounted, ref } from \"vue\";\nimport { LoadingIcon } from \"vuepress-shared/client\";\n\nimport {\n  type CommentPluginFrontmatter,\n  type GiscusInputPosition,\n  type GiscusMapping,\n  type GiscusOptions,\n  type GiscusRepo,\n  type GiscusTheme,\n} from \"../../shared/index.js\";\n\nimport \"../styles/giscus.scss\";\n\ndeclare const COMMENT_OPTIONS: GiscusOptions;\n\nconst SUPPORTED_LANGUAGES = [\n  \"de\",\n  \"gsw\",\n  \"en\",\n  \"es\",\n  \"fr\",\n  \"id\",\n  \"it\",\n  \"ja\",\n  \"ko\",\n  \"pl\",\n  \"ro\",\n  \"ru\",\n  \"tr\",\n  \"vi\",\n  \"zh-CN\",\n  \"zh-TW\",\n] as const;\n\ntype BooleanString = \"0\" | \"1\";\n\nexport type GiscusLang = (typeof SUPPORTED_LANGUAGES)[number];\n\nexport type GiscusLoading = \"lazy\" | \"eager\";\n\nexport interface GiscusProps {\n  id?: string | undefined;\n  repo: GiscusRepo;\n  repoId: string;\n  category?: string | undefined;\n  categoryId?: string | undefined;\n  mapping: GiscusMapping;\n  term?: string | undefined;\n  theme?: GiscusTheme | undefined;\n  reactionsEnabled?: BooleanString | undefined;\n  strict?: BooleanString | undefined;\n  emitMetadata?: BooleanString | undefined;\n  inputPosition?: GiscusInputPosition | undefined;\n  lang?: GiscusLang | undefined;\n  loading?: GiscusLoading | undefined;\n}\n\nconst giscusOptions = COMMENT_OPTIONS;\nconst enableGiscus = Boolean(\n  giscusOptions.repo &&\n    giscusOptions.repoId &&\n    giscusOptions.category &&\n    giscusOptions.categoryId\n);\n\nconst { repo, repoId, category, categoryId } = giscusOptions;\n\nexport default defineComponent({\n  name: \"GiscusComment\",\n\n  props: {\n    /**\n     * Whether the component is in darkmode\n     *\n     * 组件是否处于夜间模式\n     */\n    darkmode: Boolean,\n  },\n\n  setup(props) {\n    const frontmatter = usePageFrontmatter<CommentPluginFrontmatter>();\n    const page = usePageData();\n    const loaded = ref(false);\n\n    const giscusLang = computed(() => {\n      const lang = usePageLang().value as GiscusLang;\n\n      if (SUPPORTED_LANGUAGES.includes(lang)) return lang;\n\n      const shortCode = lang.split(\"-\")[0] as GiscusLang;\n\n      if (SUPPORTED_LANGUAGES.includes(shortCode)) return shortCode;\n\n      return \"en\";\n    });\n\n    const enableComment = computed(() => {\n      if (!enableGiscus) return false;\n      const pluginConfig = giscusOptions.comment !== false;\n      const pageConfig = frontmatter.value.comment;\n\n      return (\n        // Enable in page\n        Boolean(pageConfig) ||\n        // not disabled in anywhere\n        (pluginConfig !== false && pageConfig !== false)\n      );\n    });\n\n    const config = computed(\n      () =>\n        <GiscusProps>{\n          repo,\n          repoId,\n          category,\n          categoryId,\n          lang: giscusLang.value,\n          theme: props.darkmode\n            ? giscusOptions.darkTheme || \"dark\"\n            : giscusOptions.lightTheme || \"light\",\n          mapping: giscusOptions.mapping || \"pathname\",\n          term: withBase(page.value.path),\n          inputPosition: giscusOptions.inputPosition || \"top\",\n          reactionsEnabled:\n            giscusOptions.reactionsEnabled === false ? \"0\" : \"1\",\n          strict: giscusOptions.strict === false ? \"0\" : \"1\",\n          loading: giscusOptions.lazyLoading === false ? \"eager\" : \"lazy\",\n          emitMetadata: \"0\",\n        }\n    );\n\n    onMounted(async () => {\n      await import(/* webpackChunkName: \"giscus\" */ \"giscus\");\n      loaded.value = true;\n    });\n\n    return (): VNode =>\n      h(\n        \"div\",\n        {\n          class: [\n            \"giscus-wrapper\",\n            { \"input-top\": giscusOptions.inputPosition !== \"bottom\" },\n          ],\n          id: \"comment\",\n          style: {\n            display: enableComment.value ? \"block\" : \"none\",\n          },\n        },\n        loaded.value ? h(\"giscus-widget\", config.value) : h(LoadingIcon)\n      );\n  },\n});\n"],"names":["SUPPORTED_LANGUAGES","giscusOptions","enableGiscus","repo","repoId","category","categoryId","defineComponent","props","frontmatter","usePageFrontmatter","page","usePageData","loaded","ref","giscusLang","computed","lang","usePageLang","shortCode","enableComment","pluginConfig","pageConfig","config","withBase","onMounted","h","LoadingIcon"],"mappings":"4QAsBA,MAAMA,EAAsB,CAC1B,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,QACA,OACF,EAyBMC,EAAgB,gBAChBC,EAAe,CACnBD,EAAAA,EAAc,MACZA,EAAc,QACdA,EAAc,UACdA,EAAc,YAGZ,CAAE,KAAAE,EAAM,OAAAC,EAAQ,SAAAC,EAAU,WAAAC,CAAW,EAAIL,EAE/C,IAAeM,EAAAA,EAAgB,CAC7B,KAAM,gBAEN,MAAO,CAML,SAAU,OACZ,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAcC,EAA6C,EAC3DC,EAAOC,EACPC,EAAAA,EAASC,EAAI,EAAK,EAElBC,EAAaC,EAAS,IAAM,CAChC,MAAMC,EAAOC,EAAY,EAAE,MAE3B,GAAIlB,EAAoB,SAASiB,CAAI,EAAG,OAAOA,EAE/C,MAAME,EAAYF,EAAK,MAAM,GAAG,EAAE,CAAC,EAEnC,OAAIjB,EAAoB,SAASmB,CAAS,EAAUA,EAE7C,IACT,CAAC,EAEKC,EAAgBJ,EAAS,IAAM,CACnC,GAAI,CAACd,EAAc,MAAO,GAC1B,MAAMmB,EAAepB,EAAc,UAAY,GACzCqB,EAAab,EAAY,MAAM,QAErC,MAEE,CAAQa,CAAAA,GAEPD,IAAiB,IAASC,IAAe,EAE9C,CAAC,EAEKC,EAASP,EACb,KACe,CACX,KAAAb,EACA,OAAAC,EACA,SAAAC,EACA,WAAAC,EACA,KAAMS,EAAW,MACjB,MAAOP,EAAM,SACTP,EAAc,WAAa,OAC3BA,EAAc,YAAc,QAChC,QAASA,EAAc,SAAW,WAClC,KAAMuB,EAASb,EAAK,MAAM,IAAI,EAC9B,cAAeV,EAAc,eAAiB,MAC9C,iBACEA,EAAc,mBAAqB,GAAQ,IAAM,IACnD,OAAQA,EAAc,SAAW,GAAQ,IAAM,IAC/C,QAASA,EAAc,cAAgB,GAAQ,QAAU,OACzD,aAAc,GAChB,EACJ,EAEA,OAAAwB,EAAU,SAAY,CACpB,KAA8C,QAAA,QAAQ,EACtDZ,EAAO,MAAQ,EACjB,CAAC,EAEM,IACLa,EACE,MACA,CACE,MAAO,CACL,iBACA,CAAE,YAAazB,EAAc,gBAAkB,QAAS,CAC1D,EACA,GAAI,UACJ,MAAO,CACL,QAASmB,EAAc,MAAQ,QAAU,MAC3C,CACF,EACAP,EAAO,MAAQa,EAAE,gBAAiBH,EAAO,KAAK,EAAIG,EAAEC,CAAW,CACjE,CACJ,CACF,CAAC"}