{"version":3,"file":"Twikoo.js","sources":["../../../src/client/components/Twikoo.ts"],"sourcesContent":["import { usePageData, usePageFrontmatter, usePageLang } from \"@vuepress/client\";\nimport {\n  type VNode,\n  computed,\n  defineComponent,\n  h,\n  nextTick,\n  onMounted,\n  ref,\n  watch,\n} from \"vue\";\nimport { LoadingIcon } from \"vuepress-shared/client\";\n\nimport {\n  type CommentPluginFrontmatter,\n  type TwikooOptions,\n} from \"../../shared/index.js\";\n\nimport \"../styles/twikoo.scss\";\n\ndeclare const COMMENT_OPTIONS: TwikooOptions;\n\nconst twikooOption = COMMENT_OPTIONS;\nconst enableTwikoo = Boolean(twikooOption.envId);\n\nexport default defineComponent({\n  name: \"TwikooComment\",\n\n  setup() {\n    const frontmatter = usePageFrontmatter<CommentPluginFrontmatter>();\n    const lang = usePageLang();\n    const page = usePageData();\n\n    const loaded = ref(false);\n\n    const enableComment = computed(() => {\n      if (!enableTwikoo) return false;\n      const pluginConfig = twikooOption.comment !== false;\n      const pageConfig = frontmatter.value.comment;\n\n      return (\n        // Enable in page\n        Boolean(pageConfig) ||\n        // not disabled in anywhere\n        (pluginConfig !== false && pageConfig !== false)\n      );\n    });\n\n    const initTwikoo = async (): Promise<void> => {\n      if (enableComment.value) {\n        const [{ init }] = await Promise.all([\n          import(/* webpackChunkName: \"twikoo\" */ \"twikoo\"),\n          new Promise<void>((resolve) => {\n            setTimeout(() => {\n              void nextTick().then(resolve);\n            }, twikooOption.delay);\n          }),\n        ]);\n\n        loaded.value = true;\n\n        await init({\n          lang: lang.value === \"zh-CN\" ? \"zh-CN\" : \"en\",\n          ...twikooOption,\n          el: \"#twikoo-comment\",\n        });\n      }\n    };\n\n    onMounted(() => {\n      watch(\n        () => [enableComment.value, page.value.path],\n        () => initTwikoo(),\n        { immediate: true }\n      );\n    });\n\n    return (): VNode =>\n      h(\n        \"div\",\n        {\n          class: \"twikoo-wrapper\",\n          id: \"comment\",\n          style: { display: enableComment.value ? \"block\" : \"none\" },\n        },\n        loaded.value ? h(\"div\", { id: \"twikoo-comment\" }) : h(LoadingIcon)\n      );\n  },\n});\n"],"names":["twikooOption","enableTwikoo","defineComponent","frontmatter","usePageFrontmatter","lang","usePageLang","page","usePageData","loaded","ref","enableComment","computed","pluginConfig","pageConfig","initTwikoo","init","resolve","nextTick","onMounted","watch","h","LoadingIcon"],"mappings":"uRAsBA,MAAMA,EAAe,gBACfC,EAAe,CAAQD,CAAAA,EAAa,MAE1C,MAAeE,EAAgB,CAC7B,KAAM,gBAEN,OAAQ,CACN,MAAMC,EAAcC,EACdC,EAAAA,EAAOC,EACPC,EAAAA,EAAOC,IAEPC,EAASC,EAAI,EAAK,EAElBC,EAAgBC,EAAS,IAAM,CACnC,GAAI,CAACX,EAAc,MAAO,GAC1B,MAAMY,EAAeb,EAAa,UAAY,GACxCc,EAAaX,EAAY,MAAM,QAErC,MAEE,EAAQW,GAEPD,IAAiB,IAASC,IAAe,EAE9C,CAAC,EAEKC,EAAa,SAA2B,CAC5C,GAAIJ,EAAc,MAAO,CACvB,KAAM,CAAC,CAAE,KAAAK,CAAK,CAAC,EAAI,MAAM,QAAQ,IAAI,CACnC,OAAwC,QAAQ,EAChD,IAAI,QAAeC,GAAY,CAC7B,WAAW,IAAM,CACVC,EAAS,EAAE,KAAKD,CAAO,CAC9B,EAAGjB,EAAa,KAAK,CACvB,CAAC,CACH,CAAC,EAEDS,EAAO,MAAQ,GAEf,MAAMO,EAAK,CACT,KAAMX,EAAK,QAAU,QAAU,QAAU,KACzC,GAAGL,EACH,GAAI,iBACN,CAAC,EAEL,EAEA,OAAAmB,EAAU,IAAM,CACdC,EACE,IAAM,CAACT,EAAc,MAAOJ,EAAK,MAAM,IAAI,EAC3C,IAAMQ,EACN,EAAA,CAAE,UAAW,EAAK,CACpB,CACF,CAAC,EAEM,IACLM,EACE,MACA,CACE,MAAO,iBACP,GAAI,UACJ,MAAO,CAAE,QAASV,EAAc,MAAQ,QAAU,MAAO,CAC3D,EACAF,EAAO,MAAQY,EAAE,MAAO,CAAE,GAAI,gBAAiB,CAAC,EAAIA,EAAEC,CAAW,CACnE,CACJ,CACF,CAAC"}