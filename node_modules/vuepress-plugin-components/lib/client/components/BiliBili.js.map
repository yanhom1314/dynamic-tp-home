{"version":3,"file":"BiliBili.js","sources":["../../../src/client/components/BiliBili.ts"],"sourcesContent":["/* eslint-disable vue/no-unused-properties */\nimport { useEventListener } from \"@vueuse/core\";\nimport { type VNode, computed, defineComponent, h, onMounted, ref } from \"vue\";\nimport { checkIsMobile } from \"vuepress-shared/client\";\n\nimport { useSize } from \"../composables/index.js\";\nimport { videoIframeAllow } from \"../utils/index.js\";\n\nimport \"../styles/bili-bili.scss\";\n\nexport default defineComponent({\n  name: \"BiliBili\",\n\n  props: {\n    /**\n     * BiliBili video id\n     *\n     * B 站视频 ID\n     */\n    bvid: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * BiliBili video title\n     *\n     * B 站视频标题\n     */\n    title: {\n      type: String,\n      default: \"A BiliBili video\",\n    },\n\n    /**\n     * BiliBili video page\n     *\n     * B 站视频分页\n     */\n    page: {\n      type: [String, Number],\n      default: 1,\n    },\n\n    /**\n     * Component width\n     *\n     * 组件宽度\n     */\n    width: {\n      type: [String, Number],\n      default: \"100%\",\n    },\n\n    /**\n     * Component height\n     *\n     * 组件高度\n     */\n    height: {\n      type: [String, Number],\n      default: undefined,\n    },\n\n    /**\n     * Component width / height ratio\n     *\n     * 组件长宽比\n     */\n    ratio: {\n      type: [String, Number],\n      default: 16 / 9,\n    },\n\n    /**\n     * Start time in seconds\n     *\n     * 基于秒数的开始时间\n     */\n    time: {\n      type: [String, Number],\n      default: 0,\n    },\n\n    /**\n     * Whether use low quality source\n     *\n     * 是否使用低质量画质\n     */\n    lowQuality: Boolean,\n\n    /**\n     * Whether to disable danmaku\n     *\n     * 是否禁用弹幕\n     */\n    noDanmaku: Boolean,\n  },\n\n  setup(props) {\n    const isMobile = ref(false);\n    // on pc with width >= 640, a 68px hint will be under video\n    const extraHeight = computed(() => (isMobile.value ? 0 : 68));\n\n    const updateMobile = (): void => {\n      isMobile.value =\n        checkIsMobile(navigator.userAgent) || el.value!.clientWidth < 640;\n    };\n\n    const { el, width, height } = useSize<HTMLIFrameElement>(\n      props,\n      extraHeight\n    );\n\n    const videoLink = computed(\n      () =>\n        `https://player.bilibili.com/player.html?bvid=${props.bvid}&t=${\n          props.time\n        }&high_quality=${props.lowQuality ? 0 : 1}&page=${props.page}&danmaku=${\n          props.noDanmaku ? 0 : 1\n        }`\n    );\n\n    onMounted(() => {\n      updateMobile();\n      useEventListener(\"orientationchange\", () => updateMobile());\n      useEventListener(\"resize\", () => updateMobile());\n    });\n\n    return (): VNode[] => [\n      h(\n        \"div\",\n        { class: \"bili-desc\" },\n        h(\"a\", { class: \"sr-only\", href: videoLink.value }, props.title)\n      ),\n      h(\"iframe\", {\n        ref: el,\n        // Tip: `https://www.bilibili.com/blackboard/newplayer.html?bvid=${props.bvid}&as_wide=1&page=1` only support whitelist sites now\n        src: videoLink.value,\n        title: props.title,\n        class: \"bili-iframe\",\n        allow: videoIframeAllow,\n        style: {\n          width: width.value,\n          height: height.value,\n        },\n      }),\n    ];\n  },\n});\n"],"names":["BiliBili","defineComponent","props","isMobile","ref","extraHeight","computed","updateMobile","checkIsMobile","el","width","height","useSize","videoLink","onMounted","useEventListener","h","videoIframeAllow"],"mappings":"sUAUA,IAAAA,EAAeC,EAAgB,CAC7B,KAAM,WAEN,MAAO,CAML,KAAM,CACJ,KAAM,OACN,SAAU,EACZ,EAOA,MAAO,CACL,KAAM,OACN,QAAS,kBACX,EAOA,KAAM,CACJ,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,CACX,EAOA,MAAO,CACL,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,MACX,EAOA,OAAQ,CACN,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,MACX,EAOA,MAAO,CACL,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,GAAK,CAChB,EAOA,KAAM,CACJ,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,CACX,EAOA,WAAY,QAOZ,UAAW,OACb,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAWC,EAAI,EAAK,EAEpBC,EAAcC,EAAS,IAAOH,EAAS,MAAQ,EAAI,EAAG,EAEtDI,EAAe,IAAY,CAC/BJ,EAAS,MACPK,EAAc,UAAU,SAAS,GAAKC,EAAG,MAAO,YAAc,GAClE,EAEM,CAAE,GAAAA,EAAI,MAAAC,EAAO,OAAAC,CAAO,EAAIC,EAC5BV,EACAG,CACF,EAEMQ,EAAYP,EAChB,IACE,gDAAgDJ,EAAM,UACpDA,EAAM,qBACSA,EAAM,WAAa,EAAI,UAAUA,EAAM,gBACtDA,EAAM,UAAY,EAAI,GAE5B,EAEA,OAAAY,EAAU,IAAM,CACdP,EAAAA,EACAQ,EAAiB,oBAAqB,IAAMR,EAAc,CAAA,EAC1DQ,EAAiB,SAAU,IAAMR,EAAAA,CAAc,CACjD,CAAC,EAEM,IAAe,CACpBS,EACE,MACA,CAAE,MAAO,WAAY,EACrBA,EAAE,IAAK,CAAE,MAAO,UAAW,KAAMH,EAAU,KAAM,EAAGX,EAAM,KAAK,CACjE,EACAc,EAAE,SAAU,CACV,IAAKP,EAEL,IAAKI,EAAU,MACf,MAAOX,EAAM,MACb,MAAO,cACP,MAAOe,EACP,MAAO,CACL,MAAOP,EAAM,MACb,OAAQC,EAAO,KACjB,CACF,CAAC,CACH,CACF,CACF,CAAC"}