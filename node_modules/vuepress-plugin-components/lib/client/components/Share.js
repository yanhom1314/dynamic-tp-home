import{usePageData as S,usePageFrontmatter as E}from"@vuepress/client";import{isLinkHttp as C,isArray as F,isString as v,isPlainObject as H,isFunction as L}from"@vuepress/shared";import{defineComponent as b,ref as M,onMounted as P,h as o,computed as w}from"vue";import{Popup as R,isAbsoluteUrl as T,startsWith as O,endsWith as _,openPopupWindow as $}from"vuepress-shared/client";import"balloon-css/balloon.css";import"vuepress-shared/client/styles/popup.scss";import"../styles/share-service.scss";const g=t=>{var r;return((r=document.querySelector(`meta[name="${t}"]`))==null?void 0:r.getAttribute("content"))??null},q=(t,r="")=>{const a=["share-icon",r];return C(t)||T(t)?o("img",{class:a,src:t,"no-view":""}):O(t,"<")&&_(t,">")?o("div",{class:a,innerHTML:t}):o("div",{class:[...a,t]})};var j=b({name:"ShareService",props:{config:{type:Object,default:()=>({})},plain:Boolean,title:{type:String,required:!1},description:{type:String,required:!1},url:{type:String,required:!1},summary:{type:String,required:!1},cover:{type:String,required:!1},tag:{type:[Array,String],required:!1}},setup(t){let r;const a=S(),c=E(),e=M(!1),s=()=>{var n;const i=t.title??a.value.title,u=t.description??c.value.description??g("description")??g("og:description")??g("twitter:description"),m=t.url??typeof window>"u"?null:window.location.href,p=t.cover??g("og:image"),y=(n=document.querySelector(`${SHARE_CONTENT_SELECTOR} :not(a) > img`))==null?void 0:n.getAttribute("src"),f=t.tag??c.value.tag??c.value.tags,h=F(f)?f.filter(v).join(","):v(f)?f:null;return t.config.link.replace(/\[([^\]]+)\]/g,(W,k)=>{const A=k.split("|");for(const l of A){if(l==="url"&&m)return m;if(l==="title"&&i)return i;if(l==="description"&&u)return u;if(l==="summary"&&t.summary)return t.summary;if(l==="cover"&&p)return p;if(l==="image"&&y)return y;if(l==="tags"&&h)return h}return""})},d=()=>{const n=s();switch(t.config.action){case"navigate":window.open(n);break;case"open":window.open(n,"_blank");break;case"qrcode":import("qrcode").then(({toDataURL:i})=>i(n,{errorCorrectionLevel:"H",width:250,scale:1,margin:1.5})).then(i=>{r.emit(`<img src="${i}" alt="qrcode" class="share-qrcode" />`)});break;default:$(n,"share")}};return P(()=>{r=new R}),()=>{const{config:{name:n,icon:i,shape:u,color:m},plain:p}=t;return[o("button",{class:["share-button",{plain:p}],"aria-label":n,"data-balloon-pos":"up",onClick:()=>d()},p?q(u,"plain"):i?q(i):o("div",{class:"share-icon color-wrapper",style:{background:m},innerHTML:u})),e.value?o("div",{class:"share-popup"}):null]}}});const G=SHARE_SERVICES;var B=b({name:"Share",props:{services:{type:[String,Array],default:()=>G.map(({name:t})=>t)},titleGetter:{type:Function,default:t=>t.title},descriptionGetter:{type:Function,default:t=>t.frontmatter.description},summaryGetter:{type:Function,default:t=>t.summary},coverGetter:{type:Function,default:t=>t.cover},tagGetter:{type:Function,default:({frontmatter:t})=>t.tag||t.tags},inline:Boolean,colorful:Boolean},setup(t){const r=S(),a=w(()=>(v(t.services)?t.services.split(","):t.services).map(e=>H(e)?e.name&&e.link?e:null:G.find(({name:s})=>s===e)).filter(e=>e!=null)),c=w(()=>{const e={};return["titleGetter","descriptionGetter","summaryGetter","coverGetter","tagGetter"].forEach(s=>{if(L(t[s])){const d=t[s](r.value);d&&(e[s.replace("Getter","")]=d)}}),e});return()=>o("div",{class:"share-wrapper",style:t.inline?{display:"inline-block"}:{}},a.value.map(e=>o(j,{config:e,...c.value,plain:!t.colorful})))}});export{B as default};
//# sourceMappingURL=Share.js.map
