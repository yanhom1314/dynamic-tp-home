{"version":3,"file":"ChartJS.js","sources":["../../../src/client/components/ChartJS.ts"],"sourcesContent":["import { type ChartConfiguration } from \"chart.js\";\nimport {\n  type PropType,\n  type VNode,\n  defineComponent,\n  h,\n  onMounted,\n  ref,\n} from \"vue\";\nimport { LoadingIcon, atou } from \"vuepress-shared/client\";\n\nimport \"../styles/chart.scss\";\n\ndeclare const MARKDOWN_ENHANCE_DELAY: number;\n\nconst parseChartConfig = (\n  config: string,\n  type: \"js\" | \"json\"\n): ChartConfiguration => {\n  if (type === \"json\") return <ChartConfiguration>JSON.parse(config);\n\n  const exports = {};\n  const module = { exports };\n\n  eval(config);\n\n  // eslint-disable-next-line import/no-commonjs\n  return <ChartConfiguration>module.exports;\n};\n\nexport default defineComponent({\n  name: \"ChartJS\",\n\n  props: {\n    /**\n     * Chart config\n     *\n     * 图表配置\n     */\n    config: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Chart id\n     *\n     * 图表 id\n     */\n    id: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Chart title\n     *\n     * 图表标题\n     */\n    title: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Chart config type\n     *\n     * 图表配置类型\n     */\n    type: {\n      type: String as PropType<\"js\" | \"json\">,\n      default: \"json\",\n    },\n  },\n\n  setup(props) {\n    const chartElement = ref<HTMLElement>();\n    const chartCanvasElement = ref<HTMLCanvasElement>();\n\n    const loading = ref(true);\n\n    onMounted(async () => {\n      const [{ default: Chart }] = await Promise.all([\n        import(/* webpackChunkName: \"chart\" */ \"chart.js/auto\"),\n        // delay\n        new Promise((resolve) => setTimeout(resolve, MARKDOWN_ENHANCE_DELAY)),\n      ]);\n\n      Chart.defaults.maintainAspectRatio = false;\n\n      const data = parseChartConfig(atou(props.config), props.type);\n      const ctx = chartCanvasElement.value!.getContext(\"2d\")!;\n\n      new Chart(ctx, data);\n\n      loading.value = false;\n    });\n\n    return (): (VNode | null)[] => [\n      props.title\n        ? h(\"div\", { class: \"chart-title\" }, decodeURIComponent(props.title))\n        : null,\n      loading.value\n        ? h(LoadingIcon, { class: \"chart-loading\", height: 192 })\n        : null,\n      h(\n        \"div\",\n        {\n          ref: chartElement,\n          class: \"chart-wrapper\",\n          id: props.id,\n          style: {\n            display: loading.value ? \"none\" : \"block\",\n          },\n        },\n        h(\"canvas\", {\n          ref: chartCanvasElement,\n          height: 400,\n        })\n      ),\n    ];\n  },\n});\n"],"names":["props","chartElement","chartCanvasElement","loading","Chart","resolve","data","ctx"],"mappings":"mIAeA,MAAM,iBAAmB,CACvB,OACA,OACuB,CACvB,GAAI,OAAS,OAAQ,OAA2B,KAAK,MAAM,MAAM,EAEjE,MAAM,QAAU,CAAA,EACV,OAAS,CAAE,OAAQ,EAEzB,OAAK,KAAA,MAAM,EAGgB,OAAO,OACpC,EAEA,IAAe,QAAA,gBAAgB,CAC7B,KAAM,UAEN,MAAO,CAML,OAAQ,CACN,KAAM,OACN,SAAU,EACZ,EAOA,GAAI,CACF,KAAM,OACN,SAAU,EACZ,EAOA,MAAO,CACL,KAAM,OACN,QAAS,EACX,EAOA,KAAM,CACJ,KAAM,OACN,QAAS,MACX,CACF,EAEA,MAAMA,EAAO,CACX,MAAMC,EAAe,IAAiB,EAChCC,EAAqB,IAAuB,EAE5CC,EAAU,IAAI,EAAI,EAExB,iBAAU,SAAY,CACpB,KAAM,CAAC,CAAE,QAASC,CAAM,CAAC,EAAI,MAAM,QAAQ,IAAI,CAC7C,OAAuC,eAAe,EAEtD,IAAI,QAASC,GAAY,WAAWA,EAAS,sBAAsB,CAAC,CACtE,CAAC,EAEDD,EAAM,SAAS,oBAAsB,GAErC,MAAME,EAAO,iBAAiB,KAAKN,EAAM,MAAM,EAAGA,EAAM,IAAI,EACtDO,EAAML,EAAmB,MAAO,WAAW,IAAI,EAErD,IAAIE,EAAMG,EAAKD,CAAI,EAEnBH,EAAQ,MAAQ,EAClB,CAAC,EAEM,IAAwB,CAC7BH,EAAM,MACF,EAAE,MAAO,CAAE,MAAO,aAAc,EAAG,mBAAmBA,EAAM,KAAK,CAAC,EAClE,KACJG,EAAQ,MACJ,EAAE,YAAa,CAAE,MAAO,gBAAiB,OAAQ,GAAI,CAAC,EACtD,KACJ,EACE,MACA,CACE,IAAKF,EACL,MAAO,gBACP,GAAID,EAAM,GACV,MAAO,CACL,QAASG,EAAQ,MAAQ,OAAS,OACpC,CACF,EACA,EAAE,SAAU,CACV,IAAKD,EACL,OAAQ,GACV,CAAC,CACH,CACF,CACF,CACF,CAAC"}