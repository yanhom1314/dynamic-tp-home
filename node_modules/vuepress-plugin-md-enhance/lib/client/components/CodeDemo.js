import{useToggle as A}from"@vueuse/core";import{defineComponent as N,ref as b,computed as j,onMounted as D,h as r}from"vue";import{keys as C,atou as _,LoadingIcon as M}from"vuepress-shared/client";import{J as R,C as T}from"../icons-b25ac136.js";import"balloon-css/balloon.css";import"../styles/code-demo.scss";import{isPlainObject as P}from"@vuepress/shared";const L=CODE_DEMO_OPTIONS,E={html:{types:["html","slim","haml","md","markdown","vue"],map:{html:"none",vue:"none",md:"markdown"}},js:{types:["js","javascript","coffee","coffeescript","ts","typescript","ls","livescript"],map:{js:"none",javascript:"none",coffee:"coffeescript",ls:"livescript",ts:"typescript"}},css:{types:["css","less","sass","scss","stylus","styl"],map:{css:"none",styl:"stylus"}}},B=(e,s,t)=>{const n=document.createElement(e);return P(s)&&C(s).forEach(a=>{if(a.indexOf("data"))n[a]=s[a];else{const o=a.replace("data","");n.dataset[o]=s[a]}}),t&&t.forEach(a=>{n.appendChild(a)}),n},w=e=>({...L,...e,jsLib:Array.from(new Set([...L.jsLib||[],...e.jsLib||[]])),cssLib:Array.from(new Set([...L.cssLib||[],...e.cssLib||[]]))}),m=(e,s)=>{if(e[s]!==void 0)return e[s];const t=new Promise(n=>{var a;const o=document.createElement("script");o.src=s,(a=document.querySelector("body"))==null||a.appendChild(o),o.onload=()=>{n()}});return e[s]=t,t},k=(e,s)=>{if(s.css&&Array.from(e.childNodes).every(t=>t.nodeName!=="STYLE")){const t=B("style",{innerHTML:s.css});e.appendChild(t)}},V=(e,s,t)=>{const n=t.getScript();if(n&&Array.from(s.childNodes).every(a=>a.nodeName!=="SCRIPT")){const a=document.createElement("script");a.appendChild(document.createTextNode(`{const document=window.document.querySelector('#${e} .code-demo-container').shadowRoot;
${n}}`)),s.appendChild(a)}},H=e=>{const s=C(e),t={html:[],js:[],css:[],isLegal:!1};return["html","js","css"].forEach(n=>{const a=s.filter(o=>E[n].types.includes(o));if(a.length){const o=a[0];t[n]=[e[o].replace(/^\n|\n$/g,""),E[n].map[o]||o]}}),t.isLegal=(!t.html.length||t.html[1]==="none")&&(!t.js.length||t.js[1]==="none")&&(!t.css.length||t.css[1]==="none"),t},$=e=>e.replace(/<br \/>/g,"<br>").replace(/<((\S+)[^<]*?)\s+\/>/g,"<$1></$2>"),x=e=>`<div id="app">
${$(e)}
</div>`,I=e=>`${e.replace("export default ","const $reactApp = ").replace(/App\.__style__(\s*)=(\s*)`([\s\S]*)?`/,"")};
ReactDOM.createRoot(document.getElementById("app")).render(React.createElement($reactApp))`,J=e=>e.replace(/export\s+default\s*\{(\n*[\s\S]*)\n*\}\s*;?$/u,"Vue.createApp({$1}).mount('#app')").replace(/export\s+default\s*define(Async)?Component\s*\(\s*\{(\n*[\s\S]*)\n*\}\s*\)\s*;?$/u,"Vue.createApp({$1}).mount('#app')").trim(),O=e=>`(function(exports){var module={};module.exports=exports;${e};return module.exports.__esModule?module.exports.default:module.exports;})({})`,q=(e,s)=>{const t=w(s),n=e.js[0]||"";return{...t,html:$(e.html[0]||""),js:n,css:e.css[0]||"",isLegal:e.isLegal,getScript:()=>{var a;return t.useBabel?((a=window.Babel.transform(n,{presets:["es2015"]}))==null?void 0:a.code)||"":n}}},F=(e,s)=>{const t=w(s),n=e.html[0]||"",a=/<template>([\s\S]+)<\/template>/u.exec(n),o=/<script(\s*lang=(['"])(.*?)\2)?>([\s\S]+)<\/script>/u.exec(n),d=/<style(\s*lang=(['"])(.*?)\2)?\s*(?:scoped)?>([\s\S]+)<\/style>/u.exec(n),u=a?a[1].replace(/^\n|\n$/g,""):"",[i="",c=""]=o?[o[4].replace(/^\n|\n$/g,""),o[3]]:[],[l="",h=""]=d?[d[4].replace(/^\n|\n$/g,""),d[3]]:[],f=c===""&&(h===""||h==="css");return{...t,html:x(u),js:J(i),css:l,isLegal:f,jsLib:[t.vue,...t.jsLib],getScript:()=>{var y,p;const g=s.useBabel?((p=(y=window.Babel)==null?void 0:y.transform(i,{presets:["es2015"]}))==null?void 0:p.code)||"":i.replace(/export\s+default/u,"return");return`const app=window.document.createElement('div');document.firstElementChild.appendChild(app);const appOptions=${O(g)};appOptions.template=\`${u.replace("`",'\\`"')}\`;window.Vue.createApp(appOptions).mount(app);`}}},G=(e,s)=>{const t=w(s);return{...t,html:x(""),js:I(e.js[0]||""),css:e.css[0]||(e.js[0]?e.js[0].replace(/App\.__style__(?:\s*)=(?:\s*)`([\s\S]*)?`/,"$1").trim():""),isLegal:e.isLegal,jsLib:[t.react,t.reactDOM,...t.jsLib],jsx:!0,getScript:()=>{var n,a;const o=((a=(n=window.Babel)==null?void 0:n.transform(e.js[0]||"",{presets:["es2015","react"]}))==null?void 0:a.code)||"";return`window.ReactDOM.createRoot(document.firstElementChild).render(window.React.createElement(${O(o)}))`}}},v={},Y=e=>Promise.all([m(v,e.babel),m(v,e.react),m(v,e.reactDOM)]),K=e=>{const s=[m(v,e.vue)];return e.useBabel&&s.push(m(v,e.babel)),Promise.all(s)},U=e=>e.useBabel?m(v,e.babel):Promise.resolve();var W=N({name:"CodeDemo",props:{id:{type:String,required:!0},type:{type:String,default:"normal"},title:{type:String,default:""},config:{type:String,default:""},code:{type:String,required:!0}},setup(e,{slots:s}){const[t,n]=A(!1),a=b(),o=b(),d=b("0"),u=b(!1),i=j(()=>JSON.parse(e.config?_(e.config):"{}")),c=j(()=>{const p=JSON.parse(_(e.code));return H(p)}),l=j(()=>e.type==="react"?G(c.value,i.value):e.type==="vue"?F(c.value,i.value):q(c.value,i.value)),h=j(()=>l.value.isLegal),f=(p=!1)=>{const g=a.value.attachShadow({mode:"open"}),S=document.createElement("div");S.classList.add("code-demo-app"),g.appendChild(S),h.value?(p&&(S.innerHTML=l.value.html),k(g,l.value),V(e.id,g,l.value),d.value="0"):d.value="auto",u.value=!0},y=()=>{switch(e.type){case"react":return Y(l.value).then(()=>f());case"vue":return K(l.value).then(()=>f());default:return U(l.value).then(()=>f(!0))}};return D(()=>{setTimeout(()=>{y()},MARKDOWN_ENHANCE_DELAY)}),()=>{var p;return r("div",{class:"code-demo-wrapper",id:e.id},[r("div",{class:"code-demo-header"},[l.value.isLegal?r("button",{class:["toggle-button",t.value?"down":"end"],onClick:()=>{d.value=t.value?"0":`${o.value.clientHeight+13.8}px`,n()}}):null,e.title?r("span",{class:"title"},decodeURIComponent(e.title)):null,l.value.isLegal&&l.value.jsfiddle!==!1?r("form",{class:"code-demo-jsfiddle",target:"_blank",action:"https://jsfiddle.net/api/post/library/pure/",method:"post"},[r("input",{type:"hidden",name:"html",value:l.value.html}),r("input",{type:"hidden",name:"js",value:l.value.js}),r("input",{type:"hidden",name:"css",value:l.value.css}),r("input",{type:"hidden",name:"wrap",value:"1"}),r("input",{type:"hidden",name:"panel_js",value:"3"}),r("input",{type:"hidden",name:"resources",value:[...l.value.cssLib,...l.value.jsLib].join(",")}),r("button",{type:"submit",class:"jsfiddle-button",innerHTML:R,"aria-label":"JSFiddle","data-balloon-pos":"up"})]):null,!l.value.isLegal||l.value.codepen!==!1?r("form",{class:"code-demo-codepen",target:"_blank",action:"https://codepen.io/pen/define",method:"post"},[r("input",{type:"hidden",name:"data",value:JSON.stringify({html:l.value.html,js:l.value.js,css:l.value.css,js_external:l.value.jsLib.join(";"),css_external:l.value.cssLib.join(";"),layout:l.value.codepenLayout,html_pre_processor:c.value?c.value.html[1]:"none",js_pre_processor:c.value?c.value.js[1]:l.value.jsx?"babel":"none",css_pre_processor:c.value?c.value.css[1]:"none",editors:l.value.codepenEditors})}),r("button",{type:"submit",innerHTML:T,class:"codepen-button","aria-label":"Codepen","data-balloon-pos":"up"})]):null]),u.value?null:r(M,{class:"code-demo-loading"}),r("div",{ref:a,class:"code-demo-container",style:{display:h.value&&u.value?"block":"none"}}),r("div",{class:"code-demo-code-wrapper",style:{height:d.value}},r("div",{ref:o,class:"code-demo-codes"},(p=s.default)==null?void 0:p.call(s)))])}}});export{W as default};
//# sourceMappingURL=CodeDemo.js.map
