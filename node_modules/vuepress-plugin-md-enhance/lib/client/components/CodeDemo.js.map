{"version":3,"file":"CodeDemo.js","sources":["../../../src/client/utils/code-demo/utils.ts","../../../src/client/utils/code-demo/code.ts","../../../src/client/composables/loadScript.ts","../../../src/client/components/CodeDemo.ts"],"sourcesContent":["import { isPlainObject } from \"@vuepress/shared\";\nimport { keys } from \"vuepress-shared/client\";\n\nimport { type Code } from \"./typings.js\";\nimport { type CodeDemoOptions } from \"../../../shared/index.js\";\n\ndeclare const CODE_DEMO_OPTIONS: CodeDemoOptions;\n\nexport const options = CODE_DEMO_OPTIONS;\n\nexport type PreProcessorType = \"html\" | \"js\" | \"css\";\n\nexport const preProcessorConfig: Record<\n  PreProcessorType,\n  {\n    types: string[];\n    map: Record<string, string | undefined>;\n  }\n> = {\n  html: {\n    types: [\"html\", \"slim\", \"haml\", \"md\", \"markdown\", \"vue\"],\n    map: {\n      html: \"none\",\n      vue: \"none\",\n      md: \"markdown\",\n    },\n  },\n  js: {\n    types: [\n      \"js\",\n      \"javascript\",\n      \"coffee\",\n      \"coffeescript\",\n      \"ts\",\n      \"typescript\",\n      \"ls\",\n      \"livescript\",\n    ],\n    map: {\n      js: \"none\",\n      javascript: \"none\",\n      coffee: \"coffeescript\",\n      ls: \"livescript\",\n      ts: \"typescript\",\n    },\n  },\n  css: {\n    types: [\"css\", \"less\", \"sass\", \"scss\", \"stylus\", \"styl\"],\n    map: {\n      css: \"none\",\n      styl: \"stylus\",\n    },\n  },\n};\n\nexport const h = (\n  tag: string,\n  attrs?: Record<string, string>,\n  children?: HTMLElement[]\n): HTMLElement => {\n  const node = document.createElement(tag);\n\n  if (isPlainObject(attrs))\n    keys(attrs).forEach((key) => {\n      if (!key.indexOf(\"data\")) {\n        const k = key.replace(\"data\", \"\");\n\n        node.dataset[k] = attrs[key];\n      } else {\n        // @ts-ignore\n        node[key] = attrs[key];\n      }\n    });\n\n  if (children)\n    children.forEach((child) => {\n      node.appendChild(child);\n    });\n\n  return node;\n};\n\nexport const getConfig = (\n  config: Partial<CodeDemoOptions>\n): CodeDemoOptions => ({\n  ...options,\n  ...config,\n  jsLib: Array.from(\n    new Set([...(options.jsLib || []), ...(config.jsLib || [])])\n  ),\n  cssLib: Array.from(\n    new Set([...(options.cssLib || []), ...(config.cssLib || [])])\n  ),\n});\n\nexport const loadScript = (\n  state: Record<string, Promise<void>>,\n  link: string\n): Promise<void> => {\n  if (state[link] !== undefined) return state[link];\n\n  const loadEvent = new Promise<void>((resolve) => {\n    const script = document.createElement(\"script\");\n\n    script.src = link;\n    document.querySelector(\"body\")?.appendChild(script);\n\n    script.onload = (): void => {\n      resolve();\n    };\n  });\n\n  state[link] = loadEvent;\n\n  return loadEvent;\n};\n\nexport const injectCSS = (shadowRoot: ShadowRoot, code: Code): void => {\n  if (\n    code.css &&\n    // style not injected\n    Array.from(shadowRoot.childNodes).every(\n      (element) => element.nodeName !== \"STYLE\"\n    )\n  ) {\n    const style = h(\"style\", { innerHTML: code.css });\n\n    shadowRoot.appendChild(style);\n  }\n};\n\nexport const injectScript = (\n  id: string,\n  shadowRoot: ShadowRoot,\n  code: Code\n): void => {\n  const scriptText = code.getScript();\n\n  if (\n    scriptText &&\n    // style not injected\n    Array.from(shadowRoot.childNodes).every(\n      (element) => element.nodeName !== \"SCRIPT\"\n    )\n  ) {\n    const script = document.createElement(\"script\");\n\n    script.appendChild(\n      document.createTextNode(\n        // here we are fixing `document` variable back to shadowDOM\n        `{const document=window.document.querySelector('#${id} .code-demo-container').shadowRoot;\\n${scriptText}}`\n      )\n    );\n    shadowRoot.appendChild(script);\n  }\n};\n","import type Babel from \"@babel/core\";\nimport { keys } from \"vuepress-shared/client\";\n\nimport { type Code, type CodeType } from \"./typings.js\";\nimport { getConfig, preProcessorConfig } from \"./utils.js\";\nimport { type CodeDemoOptions } from \"../../../shared/index.js\";\n\ndeclare global {\n  interface Window {\n    Babel: typeof Babel;\n  }\n}\n\nexport const getCode = (code: Record<string, string>): CodeType => {\n  const languages = keys(code);\n  const result: CodeType = {\n    html: [],\n    js: [],\n    css: [],\n    isLegal: false,\n  };\n\n  ([\"html\", \"js\", \"css\"] as const).forEach((type) => {\n    const match = languages.filter((language) =>\n      preProcessorConfig[type].types.includes(language)\n    );\n\n    if (match.length) {\n      const language = match[0];\n\n      result[type] = [\n        code[language].replace(/^\\n|\\n$/g, \"\"),\n        preProcessorConfig[type].map[language] || language,\n      ];\n    }\n  });\n\n  result.isLegal =\n    (!result.html.length || result.html[1] === \"none\") &&\n    (!result.js.length || result.js[1] === \"none\") &&\n    (!result.css.length || result.css[1] === \"none\");\n\n  return result;\n};\n\nconst handleHTML = (html: string): string =>\n  html\n    .replace(/<br \\/>/g, \"<br>\")\n    .replace(/<((\\S+)[^<]*?)\\s+\\/>/g, \"<$1></$2>\");\n\nconst getHtmlTemplate = (html: string): string =>\n  `<div id=\"app\">\\n${handleHTML(html)}\\n</div>`;\n\nconst getReactTemplate = (code: string): string =>\n  `${code\n    .replace(\"export default \", \"const $reactApp = \")\n    .replace(\n      /App\\.__style__(\\s*)=(\\s*)`([\\s\\S]*)?`/,\n      \"\"\n    )};\\nReactDOM.createRoot(document.getElementById(\"app\")).render(React.createElement($reactApp))`;\n\nconst getVueJsTemplate = (js: string): string =>\n  js\n    .replace(\n      /export\\s+default\\s*\\{(\\n*[\\s\\S]*)\\n*\\}\\s*;?$/u,\n      \"Vue.createApp({$1}).mount('#app')\"\n    )\n    .replace(\n      /export\\s+default\\s*define(Async)?Component\\s*\\(\\s*\\{(\\n*[\\s\\S]*)\\n*\\}\\s*\\)\\s*;?$/u,\n      \"Vue.createApp({$1}).mount('#app')\"\n    )\n    .trim();\n\nexport const wrapper = (scriptStr: string): string =>\n  `(function(exports){var module={};module.exports=exports;${scriptStr};return module.exports.__esModule?module.exports.default:module.exports;})({})`;\n\nexport const getNormalCode = (\n  code: CodeType,\n  config: Partial<CodeDemoOptions>\n): Code => {\n  const codeConfig = getConfig(config);\n  const js = code.js[0] || \"\";\n\n  return {\n    ...codeConfig,\n    html: handleHTML(code.html[0] || \"\"),\n    js,\n    css: code.css[0] || \"\",\n    isLegal: code.isLegal,\n    getScript: (): string =>\n      codeConfig.useBabel\n        ? window.Babel.transform(js, { presets: [\"es2015\"] })?.code || \"\"\n        : js,\n  };\n};\n\nexport const getVueCode = (\n  code: CodeType,\n  config: Partial<CodeDemoOptions>\n): Code => {\n  const codeConfig = getConfig(config);\n\n  const vueTemplate = code.html[0] || \"\";\n  const htmlBlock = /<template>([\\s\\S]+)<\\/template>/u.exec(vueTemplate);\n  const jsBlock = /<script(\\s*lang=(['\"])(.*?)\\2)?>([\\s\\S]+)<\\/script>/u.exec(\n    vueTemplate\n  );\n  const cssBlock =\n    /<style(\\s*lang=(['\"])(.*?)\\2)?\\s*(?:scoped)?>([\\s\\S]+)<\\/style>/u.exec(\n      vueTemplate\n    );\n  const html = htmlBlock ? htmlBlock[1].replace(/^\\n|\\n$/g, \"\") : \"\";\n  const [js = \"\", jsLang = \"\"] = jsBlock\n    ? [jsBlock[4].replace(/^\\n|\\n$/g, \"\"), jsBlock[3]]\n    : [];\n  const [css = \"\", cssLang = \"\"] = cssBlock\n    ? [cssBlock[4].replace(/^\\n|\\n$/g, \"\"), cssBlock[3]]\n    : [];\n\n  const isLegal = jsLang === \"\" && (cssLang === \"\" || cssLang === \"css\");\n\n  return {\n    ...codeConfig,\n    html: getHtmlTemplate(html),\n    js: getVueJsTemplate(js),\n    css,\n    isLegal,\n    jsLib: [codeConfig.vue, ...codeConfig.jsLib],\n    getScript: (): string => {\n      const scriptStr = config.useBabel\n        ? window.Babel?.transform(js, { presets: [\"es2015\"] })?.code || \"\"\n        : js.replace(/export\\s+default/u, \"return\");\n\n      return `const app=window.document.createElement('div');document.firstElementChild.appendChild(app);const appOptions=${wrapper(\n        scriptStr\n      )};appOptions.template=\\`${html.replace(\n        \"`\",\n        '\\\\`\"'\n      )}\\`;window.Vue.createApp(appOptions).mount(app);`;\n    },\n  };\n};\n\nexport const getReactCode = (\n  code: CodeType,\n  config: Partial<CodeDemoOptions>\n): Code => {\n  const codeConfig = getConfig(config);\n\n  return {\n    ...codeConfig,\n    html: getHtmlTemplate(\"\"),\n    js: getReactTemplate(code.js[0] || \"\"),\n    css:\n      code.css[0] ||\n      (code.js[0]\n        ? code.js[0]\n            .replace(/App\\.__style__(?:\\s*)=(?:\\s*)`([\\s\\S]*)?`/, \"$1\")\n            .trim()\n        : \"\"),\n    isLegal: code.isLegal,\n    jsLib: [codeConfig.react, codeConfig.reactDOM, ...codeConfig.jsLib],\n    jsx: true,\n    getScript: (): string => {\n      const scriptStr =\n        window.Babel?.transform(code.js[0] || \"\", {\n          presets: [\"es2015\", \"react\"],\n        })?.code || \"\";\n\n      return `window.ReactDOM.createRoot(document.firstElementChild).render(window.React.createElement(${wrapper(\n        scriptStr\n      )}))`;\n    },\n  };\n};\n","import { type Code, loadScript } from \"../utils/index.js\";\n\nexport type ScriptLoadState = Record<string, Promise<void>>;\n\nconst state: ScriptLoadState = {};\n\nexport const useState = (): ScriptLoadState => state;\n\nexport const loadReact = (code: Code): Promise<void[]> =>\n  Promise.all([\n    loadScript(state, code.babel),\n    loadScript(state, code.react),\n    loadScript(state, code.reactDOM),\n  ]);\n\nexport const loadVue = (code: Code): Promise<void[]> => {\n  const promises = [loadScript(state, code.vue)];\n\n  if (code.useBabel) promises.push(loadScript(state, code.babel));\n\n  return Promise.all(promises);\n};\n\nexport const loadNormal = (code: Code): Promise<void> =>\n  code.useBabel ? loadScript(state, code.babel) : Promise.resolve();\n","import { useToggle } from \"@vueuse/core\";\nimport {\n  type PropType,\n  type VNode,\n  computed,\n  defineComponent,\n  h,\n  onMounted,\n  ref,\n} from \"vue\";\nimport { LoadingIcon, atou } from \"vuepress-shared/client\";\n\nimport { CODEPEN_SVG, JSFIDDLE_SVG } from \"./icons.js\";\nimport { type CodeDemoOptions } from \"../../shared/index.js\";\nimport { loadNormal, loadReact, loadVue } from \"../composables/index.js\";\nimport {\n  getCode,\n  getNormalCode,\n  getReactCode,\n  getVueCode,\n  injectCSS,\n  injectScript,\n} from \"../utils/index.js\";\n\nimport \"balloon-css/balloon.css\";\nimport \"../styles/code-demo.scss\";\n\ndeclare const MARKDOWN_ENHANCE_DELAY: number;\n\nexport default defineComponent({\n  name: \"CodeDemo\",\n\n  props: {\n    /**\n     * Code demo id\n     *\n     * 代码演示 id\n     */\n    id: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Code demo type\n     *\n     * 代码演示类型\n     */\n    type: {\n      type: String as PropType<\"normal\" | \"vue\" | \"react\">,\n      default: \"normal\",\n    },\n\n    /**\n     * Code demo title\n     *\n     * 代码演示标题\n     */\n    title: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Code demo config\n     *\n     * 代码演示配置\n     */\n    config: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Code demo code content\n     *\n     * 代码演示代码内容\n     */\n    code: {\n      type: String,\n      required: true,\n    },\n  },\n\n  setup(props, { slots }) {\n    const [isExpanded, toggleIsExpand] = useToggle(false);\n    const demoWrapper = ref<HTMLDivElement>();\n    const codeContainer = ref<HTMLDivElement>();\n    const height = ref(\"0\");\n    const loaded = ref(false);\n\n    const config = computed(\n      () =>\n        <Partial<CodeDemoOptions>>(\n          JSON.parse(props.config ? atou(props.config) : \"{}\")\n        )\n    );\n\n    const codeType = computed(() => {\n      const codeConfig = <Record<string, string>>JSON.parse(atou(props.code));\n\n      return getCode(codeConfig);\n    });\n\n    const code = computed(() =>\n      props.type === \"react\"\n        ? getReactCode(codeType.value, config.value)\n        : props.type === \"vue\"\n        ? getVueCode(codeType.value, config.value)\n        : getNormalCode(codeType.value, config.value)\n    );\n\n    const isLegal = computed(() => code.value.isLegal);\n\n    const initDom = (innerHTML = false): void => {\n      // attach a shadow root to demo\n\n      const shadowRoot = demoWrapper.value!.attachShadow({ mode: \"open\" });\n      const appElement = document.createElement(\"div\");\n\n      appElement.classList.add(\"code-demo-app\");\n      shadowRoot.appendChild(appElement);\n\n      if (isLegal.value) {\n        if (innerHTML) appElement.innerHTML = code.value.html;\n        injectCSS(shadowRoot, code.value);\n        injectScript(props.id, shadowRoot, code.value);\n\n        height.value = \"0\";\n      } else {\n        height.value = \"auto\";\n      }\n\n      loaded.value = true;\n    };\n\n    const loadDemo = (): Promise<void> => {\n      switch (props.type) {\n        case \"react\": {\n          return loadReact(code.value).then(() => initDom());\n        }\n        case \"vue\": {\n          return loadVue(code.value).then(() => initDom());\n        }\n\n        default: {\n          return loadNormal(code.value).then(() => initDom(true));\n        }\n      }\n    };\n\n    onMounted(() => {\n      setTimeout(() => {\n        void loadDemo();\n      }, MARKDOWN_ENHANCE_DELAY);\n    });\n\n    return (): VNode =>\n      h(\"div\", { class: \"code-demo-wrapper\", id: props.id }, [\n        h(\"div\", { class: \"code-demo-header\" }, [\n          code.value.isLegal\n            ? h(\"button\", {\n                class: [\"toggle-button\", isExpanded.value ? \"down\" : \"end\"],\n                onClick: () => {\n                  height.value = isExpanded.value\n                    ? \"0\"\n                    : `${codeContainer.value!.clientHeight + 13.8}px`;\n                  toggleIsExpand();\n                },\n              })\n            : null,\n          props.title\n            ? h(\"span\", { class: \"title\" }, decodeURIComponent(props.title))\n            : null,\n\n          code.value.isLegal && code.value.jsfiddle !== false\n            ? h(\n                \"form\",\n                {\n                  class: \"code-demo-jsfiddle\",\n                  target: \"_blank\",\n                  action: \"https://jsfiddle.net/api/post/library/pure/\",\n                  method: \"post\",\n                },\n                [\n                  h(\"input\", {\n                    type: \"hidden\",\n                    name: \"html\",\n                    value: code.value.html,\n                  }),\n                  h(\"input\", {\n                    type: \"hidden\",\n                    name: \"js\",\n                    value: code.value.js,\n                  }),\n                  h(\"input\", {\n                    type: \"hidden\",\n                    name: \"css\",\n                    value: code.value.css,\n                  }),\n                  h(\"input\", { type: \"hidden\", name: \"wrap\", value: \"1\" }),\n                  h(\"input\", { type: \"hidden\", name: \"panel_js\", value: \"3\" }),\n                  h(\"input\", {\n                    type: \"hidden\",\n                    name: \"resources\",\n                    value: [...code.value.cssLib, ...code.value.jsLib].join(\n                      \",\"\n                    ),\n                  }),\n                  h(\"button\", {\n                    type: \"submit\",\n                    class: \"jsfiddle-button\",\n                    innerHTML: JSFIDDLE_SVG,\n                    \"aria-label\": \"JSFiddle\",\n                    \"data-balloon-pos\": \"up\",\n                  }),\n                ]\n              )\n            : null,\n\n          !code.value.isLegal || code.value.codepen !== false\n            ? h(\n                \"form\",\n                {\n                  class: \"code-demo-codepen\",\n                  target: \"_blank\",\n                  action: \"https://codepen.io/pen/define\",\n                  method: \"post\",\n                },\n                [\n                  h(\"input\", {\n                    type: \"hidden\",\n                    name: \"data\",\n                    value: JSON.stringify({\n                      html: code.value.html,\n                      js: code.value.js,\n                      css: code.value.css,\n                      // eslint-disable-next-line @typescript-eslint/naming-convention\n                      js_external: code.value.jsLib.join(\";\"),\n                      // eslint-disable-next-line @typescript-eslint/naming-convention\n                      css_external: code.value.cssLib.join(\";\"),\n                      layout: code.value.codepenLayout,\n                      // eslint-disable-next-line @typescript-eslint/naming-convention\n                      html_pre_processor: codeType.value\n                        ? codeType.value.html[1]\n                        : \"none\",\n                      // eslint-disable-next-line @typescript-eslint/naming-convention\n                      js_pre_processor: codeType.value\n                        ? codeType.value.js[1]\n                        : code.value.jsx\n                        ? \"babel\"\n                        : \"none\",\n                      // eslint-disable-next-line @typescript-eslint/naming-convention\n                      css_pre_processor: codeType.value\n                        ? codeType.value.css[1]\n                        : \"none\",\n                      editors: code.value.codepenEditors,\n                    }),\n                  }),\n                  h(\"button\", {\n                    type: \"submit\",\n                    innerHTML: CODEPEN_SVG,\n                    class: \"codepen-button\",\n                    \"aria-label\": \"Codepen\",\n                    \"data-balloon-pos\": \"up\",\n                  }),\n                ]\n              )\n            : null,\n        ]),\n        loaded.value ? null : h(LoadingIcon, { class: \"code-demo-loading\" }),\n        h(\"div\", {\n          ref: demoWrapper,\n          class: \"code-demo-container\",\n          style: {\n            display: isLegal.value && loaded.value ? \"block\" : \"none\",\n          },\n        }),\n\n        h(\n          \"div\",\n          { class: \"code-demo-code-wrapper\", style: { height: height.value } },\n          h(\n            \"div\",\n            {\n              ref: codeContainer,\n              class: \"code-demo-codes\",\n            },\n            slots[\"default\"]?.()\n          )\n        ),\n      ]);\n  },\n});\n"],"names":["options","preProcessorConfig","h","tag","attrs","children","node","isPlainObject","keys","key","k","child","getConfig","config","loadScript","state","link","loadEvent","resolve","_a","script","injectCSS","shadowRoot","code","element","style","injectScript","id","scriptText","getCode","languages","result","type","match","language","handleHTML","html","getHtmlTemplate","getReactTemplate","getVueJsTemplate","js","wrapper","scriptStr","getNormalCode","codeConfig","getVueCode","vueTemplate","htmlBlock","jsBlock","cssBlock","jsLang","css","cssLang","isLegal","_b","getReactCode","loadReact","loadVue","promises","loadNormal","CodeDemo","defineComponent","props","slots","isExpanded","toggleIsExpand","useToggle","demoWrapper","ref","codeContainer","height","loaded","computed","atou","codeType","initDom","innerHTML","appElement","loadDemo","onMounted","JSFIDDLE_SVG","CODEPEN_SVG","LoadingIcon"],"mappings":"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"}