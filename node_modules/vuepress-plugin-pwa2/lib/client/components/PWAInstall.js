import{useEventListener as g,useToggle as A}from"@vueuse/core";import{defineComponent as h,ref as c,onMounted as f,h as e,computed as b}from"vue";import{useLocaleConfig as w}from"vuepress-shared/client";import{withBase as C}from"@vuepress/client";import{l as I,C as y,A as k,a as S}from"../define-3fd15ee3.js";import"../styles/modal.scss";var P=h({name:"PWAInstallModal",props:{useHint:Boolean},emits:["canInstall","hint","toggle"],setup(p,{emit:o}){const l=w(I),t=c({}),i=c(),u=async()=>{const a=localStorage.getItem("manifest");if(a)t.value=JSON.parse(a);else try{const n=await(await fetch(C("manifest.webmanifest"))).json();t.value=n,localStorage.setItem("manifest",JSON.stringify(n))}catch{console.error("[PWA]: Error getting manifest, check that you have a valid web manifest or network connection")}},v=()=>{const a=document.querySelector(".screenshot");a&&a.scrollBy({left:-a.clientWidth,top:0,behavior:"smooth"})},r=()=>{const a=document.querySelector(".screenshot");a&&a.scrollBy({left:a.clientWidth,top:0,behavior:"smooth"})},d=async()=>{i.value&&(i.value.prompt(),document.dispatchEvent(new CustomEvent("show")),(await i.value.userChoice).outcome==="accepted"?(console.info("PWA has been installed"),o("toggle",!1),o("canInstall",!1)):(console.info("You choose to not install PWA"),o("toggle",!1),o("canInstall",!1)))},m=()=>{console.info("You accepted the install hint"),o("hint")};return f(()=>{window.hasOwnProperty("BeforeInstallPromptEvent")&&(g(window,"beforeinstallprompt",a=>{i.value=a,o("canInstall",!0),a.preventDefault(),g("keyup",n=>{n.key==="Escape"&&o("toggle",!1)})}),u())}),()=>{var a;return e("div",{id:"install-modal-wrapper"},[e("div",{class:"background",onClick:()=>o("toggle",!1)}),e("div",{class:"install-modal"},[e("div",{class:"header"},[e("button",{class:"close-button","aria-label":l.value.close,onClick:()=>o("toggle",!1)},e(y)),e("div",{class:"logo"},[t.value.icons?e("img",{src:(a=t.value.icons[0])==null?void 0:a.src,alt:"App Logo"}):null,e("div",{class:"title"},[e("h1",t.value.short_name||t.value.name),e("p",{class:"desc"},l.value.explain)])])]),e("div",{class:"content"},[e("div",{class:"highlight"},[t.value.features?e("div",{class:"feature-wrapper"},[e("h3",l.value.feature),e("ul",t.value.features.map(n=>e("li",n)))]):null,t.value.screenshots?e("div",{class:"screenshot-wrapper"},[e("button",{"aria-label":l.value.prevImage,onClick:v},e(k)),e("section",{class:"screenshot"},[t.value.screenshots.map(n=>e("div",e("img",{src:n.src,alt:"App Screenshot"})))]),e("button",{"aria-label":l.value.nextImage,onClick:r},e(S))]):null]),e("div",{class:"description"},[e("h3",l.value.desc),e("p",t.value.description)])]),p.useHint?e("div",{class:"ios-text",onClick:m},[e("p",l.value.iOSInstall),e("button",{class:"success"},"Got it!")]):e("div",{class:"button-wrapper"},[e("button",{class:"install-button",onClick:d},[l.value.install,e("span",t.value.short_name)]),e("button",{class:"cancel-button",onClick:()=>o("toggle",!1)},l.value.cancel)])])])}}}),W=h({name:"PWAInstall",setup(){const p=w(I),[o,l]=A(!1),t=c(!1),i=c(!1),u=c(!1),v=c(!1),r=c(!1),d=b(()=>u.value&&v.value&&r.value===!1),m=b(()=>i.value&&t.value||d.value),a=()=>navigator.standalone?navigator.standalone:matchMedia("(display-mode: standalone)").matches,n=()=>{l(!1),r.value=!0,localStorage.setItem("iOS-pwa-hint","hinted")};return f(()=>{if(a()){const{userAgent:s}=navigator;u.value=s.includes("iPhone")||s.includes("iPad")||!!(s.includes("Macintosh")&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2),v.value=navigator.userAgent.includes("Safari")&&!s.includes("Chrome"),r.value=!!localStorage.getItem("iOS-pwa-hint")}"getInstalledRelatedApps"in navigator&&navigator.getInstalledRelatedApps().then(s=>{i.value=s.length>0})}),()=>e("div",{id:"pwa-install"},[m.value?e("button",{class:"modal-button",useHint:d.value,onClick:()=>{l(!0)}},p.value.install):null,e(P,{style:{display:o.value?"block":"none"},onCanInstall:s=>{t.value=s},onHint:()=>n(),onToggle:l})])}});export{W as default};
//# sourceMappingURL=PWAInstall.js.map
