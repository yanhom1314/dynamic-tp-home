{"version":3,"file":"perf.js","sources":["../../src/node/perf.ts"],"sourcesContent":["import { type ThemeFunction } from \"@vuepress/core\";\nimport { isPlainObject } from \"@vuepress/shared\";\nimport { watch } from \"chokidar\";\n\nimport { extendsBundlerOptions } from \"./bundler.js\";\nimport { checkUserPlugin, vuePressVersionCheck } from \"./check/index.js\";\nimport { checkLegacyStyle, convertThemeOptions } from \"./compact/index.js\";\nimport {\n  checkSocialMediaIcons,\n  getStatus,\n  getThemeData,\n} from \"./config/index.js\";\nimport { addFavicon } from \"./init/index.js\";\nimport { getPluginConfig, usePlugin } from \"./plugins/index.js\";\nimport {\n  prepareHighLighterScss,\n  preparePerformanceConfigFile,\n  prepareSidebarData,\n  prepareSocialMediaIcons,\n  prepareThemeColorScss,\n} from \"./prepare/index.js\";\nimport { type HopeThemeBehaviorOptions } from \"./typings/index.js\";\nimport { TEMPLATE_FOLDER } from \"./utils.js\";\nimport { type ThemeOptions } from \"../shared/index.js\";\n\nexport const hopeTheme =\n  (\n    options: ThemeOptions,\n    behavior: HopeThemeBehaviorOptions | boolean = false\n  ): ThemeFunction =>\n  (app) => {\n    const behaviorOptions = isPlainObject(behavior)\n      ? behavior\n      : behavior\n      ? { compact: true, check: true }\n      : {};\n    const isDebug = behaviorOptions.debug ? (app.env.isDebug = true) : false;\n\n    const {\n      favicon,\n      hotReload = isDebug,\n      plugins = {},\n      hostname,\n      iconAssets,\n      iconPrefix,\n      backToTop,\n      sidebarSorter,\n      ...themeOptions\n    } = behaviorOptions.compact\n      ? convertThemeOptions(options as ThemeOptions & Record<string, unknown>)\n      : options;\n\n    if (behaviorOptions.compact) checkLegacyStyle(app);\n\n    vuePressVersionCheck(app);\n\n    const status = getStatus(app, options);\n    const themeData = getThemeData(app, themeOptions, status);\n    const icons = status.enableBlog ? checkSocialMediaIcons(themeData) : {};\n\n    usePlugin(app, themeData, plugins, hotReload, behaviorOptions);\n\n    if (isDebug) console.log(\"Theme plugin options:\", plugins);\n\n    return {\n      name: \"vuepress-theme-hope\",\n\n      define: () => ({\n        BLOG_TYPE_INFO: status.blogType,\n        ENABLE_BLOG: status.enableBlog,\n        ENABLE_READING_TIME: status.enableReadingTime,\n        HAS_MULTIPLE_LANGUAGES: status.hasMultipleLanguages,\n        SUPPORT_PAGEVIEW: status.supportPageview,\n      }),\n\n      extendsBundlerOptions,\n\n      onInitialized: (app): void => {\n        if (favicon) addFavicon(app, favicon);\n        if (behaviorOptions.check) checkUserPlugin(app);\n      },\n\n      onPrepared: (app): Promise<void> =>\n        Promise.all([\n          prepareSidebarData(app, themeData, sidebarSorter),\n          prepareHighLighterScss(app, plugins),\n          prepareThemeColorScss(app, themeData),\n          prepareSocialMediaIcons(app, icons),\n        ]).then(() => void 0),\n\n      onWatched: (app, watchers): void => {\n        if (hotReload) {\n          // this ensure the page is generated or updated\n          const structureSidebarWatcher = watch(\"pages/**/*.vue\", {\n            cwd: app.dir.temp(),\n            ignoreInitial: true,\n          });\n\n          structureSidebarWatcher.on(\"add\", () => {\n            void prepareSidebarData(app, themeData, sidebarSorter);\n          });\n          structureSidebarWatcher.on(\"change\", () => {\n            void prepareSidebarData(app, themeData, sidebarSorter);\n          });\n          structureSidebarWatcher.on(\"unlink\", () => {\n            void prepareSidebarData(app, themeData, sidebarSorter);\n          });\n\n          watchers.push(structureSidebarWatcher);\n        }\n      },\n\n      plugins: getPluginConfig(\n        app,\n        plugins,\n        themeData,\n\n        // @ts-ignore\n        {\n          backToTop,\n          hostname,\n          hotReload,\n          iconAssets,\n          iconPrefix,\n          favicon,\n        },\n        behaviorOptions.compact\n      ),\n\n      templateBuild: `${TEMPLATE_FOLDER}index.build.html`,\n\n      clientConfigFile: (app) => preparePerformanceConfigFile(app, status),\n    };\n  };\n\nexport * from \"../node/helpers.js\";\nexport * from \"../node/locales/index.js\";\nexport * from \"../shared/index.js\";\n"],"names":["hopeTheme","options","behavior","app","behaviorOptions","isPlainObject","isDebug","favicon","hotReload","plugins","hostname","iconAssets","iconPrefix","backToTop","sidebarSorter","themeOptions","convertThemeOptions","checkLegacyStyle","vuePressVersionCheck","status","getStatus","themeData","getThemeData","icons","checkSocialMediaIcons","usePlugin","extendsBundlerOptions","addFavicon","checkUserPlugin","prepareSidebarData","prepareHighLighterScss","prepareThemeColorScss","prepareSocialMediaIcons","watchers","structureSidebarWatcher","watch","getPluginConfig","TEMPLATE_FOLDER","preparePerformanceConfigFile"],"mappings":"0tCAyBa,MAAAA,EACX,CACEC,EACAC,EAA+C,KAEhDC,GAAQ,CACP,MAAMC,EAAkBC,EAAcH,CAAQ,EAC1CA,EACAA,EACA,CAAE,QAAS,GAAM,MAAO,EAAK,EAC7B,CAAC,EACCI,EAAUF,EAAgB,MAASD,EAAI,IAAI,QAAU,GAAQ,GAE7D,CACJ,QAAAI,EACA,UAAAC,EAAYF,EACZ,QAAAG,EAAU,CAAA,EACV,SAAAC,EACA,WAAAC,EACA,WAAAC,EACA,UAAAC,EACA,cAAAC,EACA,GAAGC,CACL,EAAIX,EAAgB,QAChBY,EAAoBf,CAAiD,EACrEA,EAEAG,EAAgB,SAASa,EAAiBd,CAAG,EAEjDe,EAAqBf,CAAG,EAExB,MAAMgB,EAASC,EAAUjB,EAAKF,CAAO,EAC/BoB,EAAYC,EAAanB,EAAKY,EAAcI,CAAM,EAClDI,EAAQJ,EAAO,WAAaK,EAAsBH,CAAS,EAAI,CAErE,EAAA,OAAAI,EAAUtB,EAAKkB,EAAWZ,EAASD,EAAWJ,CAAe,EAEzDE,GAAS,QAAQ,IAAI,wBAAyBG,CAAO,EAElD,CACL,KAAM,sBAEN,OAAQ,KAAO,CACb,eAAgBU,EAAO,SACvB,YAAaA,EAAO,WACpB,oBAAqBA,EAAO,kBAC5B,uBAAwBA,EAAO,qBAC/B,iBAAkBA,EAAO,eAC3B,GAEA,sBAAAO,EAEA,cAAgBvB,GAAc,CACxBI,GAASoB,EAAWxB,EAAKI,CAAO,EAChCH,EAAgB,OAAOwB,EAAgBzB,CAAG,CAChD,EAEA,WAAaA,GACX,QAAQ,IAAI,CACV0B,EAAmB1B,EAAKkB,EAAWP,CAAa,EAChDgB,EAAuB3B,EAAKM,CAAO,EACnCsB,EAAsB5B,EAAKkB,CAAS,EACpCW,EAAwB7B,EAAKoB,CAAK,CACpC,CAAC,EAAE,KAAK,IAAG,EAAS,EAEtB,UAAW,CAACpB,EAAK8B,IAAmB,CAClC,GAAIzB,EAAW,CAEb,MAAM0B,EAA0BC,EAAM,iBAAkB,CACtD,IAAKhC,EAAI,IAAI,KACb,EAAA,cAAe,EACjB,CAAC,EAED+B,EAAwB,GAAG,MAAO,IAAM,CACjCL,EAAmB1B,EAAKkB,EAAWP,CAAa,CACvD,CAAC,EACDoB,EAAwB,GAAG,SAAU,IAAM,CACpCL,EAAmB1B,EAAKkB,EAAWP,CAAa,CACvD,CAAC,EACDoB,EAAwB,GAAG,SAAU,IAAM,CACpCL,EAAmB1B,EAAKkB,EAAWP,CAAa,CACvD,CAAC,EAEDmB,EAAS,KAAKC,CAAuB,EAEzC,EAEA,QAASE,EACPjC,EACAM,EACAY,EAGA,CACE,UAAAR,EACA,SAAAH,EACA,UAAAF,EACA,WAAAG,EACA,WAAAC,EACA,QAAAL,CACF,EACAH,EAAgB,OAClB,EAEA,cAAe,GAAGiC,oBAElB,iBAAmBlC,GAAQmC,EAA6BnC,EAAKgB,CAAM,CACrE,CACF"}