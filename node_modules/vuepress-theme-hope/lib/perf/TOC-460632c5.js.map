{"version":3,"file":"TOC-460632c5.js","sources":["../../src/client/modules/info/components/PrintButton.ts","../../src/client/modules/info/components/TOC.ts"],"sourcesContent":["import { type VNode, defineComponent, h } from \"vue\";\n\nimport {\n  useThemeData,\n  useThemeLocaleData,\n} from \"@theme-hope/composables/index\";\nimport { PrintIcon } from \"@theme-hope/modules/info/components/icons\";\n\nimport \"../styles/print-button.scss\";\n\nexport default defineComponent({\n  name: \"PrintButton\",\n\n  setup() {\n    const themeData = useThemeData();\n    const themeLocale = useThemeLocaleData();\n\n    return (): VNode | null =>\n      themeData.value.print === false\n        ? null\n        : h(\n            \"button\",\n            {\n              class: \"print-button\",\n              title: themeLocale.value.metaLocales.print,\n              onClick: () => {\n                window.print();\n              },\n            },\n            h(PrintIcon)\n          );\n  },\n});\n","import { type PageHeader, usePageData } from \"@vuepress/client\";\nimport {\n  type PropType,\n  type VNode,\n  defineComponent,\n  h,\n  onMounted,\n  ref,\n  watch,\n} from \"vue\";\nimport { RouterLink, useRoute } from \"vue-router\";\nimport { isActiveLink } from \"vuepress-shared/client\";\n\nimport PrintButton from \"@theme-hope/modules/info/components/PrintButton\";\nimport { useMetaLocale } from \"@theme-hope/modules/info/composables/index\";\n\nimport \"../styles/toc.scss\";\n\nconst renderHeader = ({ title, level, slug }: PageHeader): VNode =>\n  h(\n    RouterLink,\n    {\n      to: `#${slug}`,\n      class: [\"toc-link\", `level${level}`],\n    },\n    () => title\n  );\n\nconst renderChildren = (\n  headers: PageHeader[],\n  headerDepth: number\n): VNode | null => {\n  const route = useRoute();\n\n  return headers.length && headerDepth > 0\n    ? h(\n        \"ul\",\n        { class: \"toc-list\" },\n        headers.map((header) => [\n          h(\n            \"li\",\n            {\n              class: [\n                \"toc-item\",\n                { active: isActiveLink(route, `#${header.slug}`) },\n              ],\n            },\n            renderHeader(header)\n          ),\n          renderChildren(header.children, headerDepth - 1),\n        ])\n      )\n    : null;\n};\n\nexport default defineComponent({\n  name: \"TOC\",\n\n  props: {\n    /**\n     * TOC items config\n     *\n     * TOC 项目配置\n     */\n    items: {\n      type: Array as PropType<PageHeader[]>,\n      default: () => [],\n    },\n\n    /**\n     * Max header nesting depth\n     *\n     * 最大的标题嵌套深度\n     */\n    headerDepth: {\n      type: Number,\n      default: 2,\n    },\n  },\n\n  setup(props, { slots }) {\n    const route = useRoute();\n    const page = usePageData();\n    const metaLocale = useMetaLocale();\n    const toc = ref<HTMLElement>();\n\n    const scrollTo = (top: number): void => {\n      toc.value?.scrollTo({ top, behavior: \"smooth\" });\n    };\n\n    onMounted(() => {\n      // scroll to active toc item\n      watch(\n        () => route.hash,\n        (hash): void => {\n          if (toc.value) {\n            // get the active toc item DOM, whose href equals to the current route\n            const activeTocItem = document.querySelector(\n              `#toc a.toc-link[href$=\"${hash}\"]`\n            );\n\n            if (!activeTocItem) return;\n\n            // get the top and height of the toc\n            const { top: tocTop, height: tocHeight } =\n              toc.value.getBoundingClientRect();\n            // get the top and height of the active toc item\n            const { top: activeTocItemTop, height: activeTocItemHeight } =\n              activeTocItem.getBoundingClientRect();\n\n            // when the active toc item overflows the top edge of toc\n            if (activeTocItemTop < tocTop)\n              // scroll to the top edge of toc\n              scrollTo(toc.value.scrollTop + activeTocItemTop - tocTop);\n            // when the active toc item overflows the bottom edge of toc\n            else if (\n              activeTocItemTop + activeTocItemHeight >\n              tocTop + tocHeight\n            )\n              // scroll to the bottom edge of toc\n              scrollTo(\n                toc.value.scrollTop +\n                  activeTocItemTop +\n                  activeTocItemHeight -\n                  tocTop -\n                  tocHeight\n              );\n          }\n        }\n      );\n    });\n\n    return (): VNode | null => {\n      const tocHeaders = props.items.length\n        ? renderChildren(props.items, props.headerDepth)\n        : page.value.headers\n        ? renderChildren(page.value.headers, props.headerDepth)\n        : null;\n\n      return tocHeaders\n        ? h(\"div\", { class: \"toc-place-holder\" }, [\n            h(\"aside\", { id: \"toc\" }, [\n              slots[\"before\"]?.(),\n              h(\"div\", { class: \"toc-header\" }, [\n                metaLocale.value.toc,\n                h(PrintButton),\n              ]),\n              h(\"div\", { class: \"toc-wrapper\", ref: toc }, tocHeaders),\n              slots[\"after\"]?.(),\n            ]),\n          ])\n        : null;\n    };\n  },\n});\n"],"names":["C","defineComponent","themeData","useThemeData","themeLocale","useThemeLocaleData","h","PrintIcon","renderHeader","title","level","slug","RouterLink","renderChildren","headers","headerDepth","route","useRoute","header","isActiveLink","props","slots","page","usePageData","metaLocale","useMetaLocale","toc","ref","scrollTo","top","_a","onMounted","watch","hash","activeTocItem","tocTop","tocHeight","activeTocItemTop","activeTocItemHeight","_b","tocHeaders","PrintButton"],"mappings":"8UAUA,IAAAA,EAAeC,EAAgB,CAC7B,KAAM,cAEN,OAAQ,CACN,MAAMC,EAAYC,EAAa,EACzBC,EAAcC,EAAAA,EAEpB,MAAO,IACLH,EAAU,MAAM,QAAU,GACtB,KACAI,EACE,SACA,CACE,MAAO,eACP,MAAOF,EAAY,MAAM,YAAY,MACrC,QAAS,IAAM,CACb,OAAO,OACT,CACF,EACAE,EAAEC,CAAS,CACb,CACR,CACF,CAAC,ECdD,MAAMC,EAAe,CAAC,CAAE,MAAAC,EAAO,MAAAC,EAAO,KAAAC,CAAK,IACzCL,EACEM,EACA,CACE,GAAI,IAAID,IACR,MAAO,CAAC,WAAY,QAAQD,GAAO,CACrC,EACA,IAAMD,CACR,EAEII,EAAiB,CACrBC,EACAC,IACiB,CACjB,MAAMC,EAAQC,IAEd,OAAOH,EAAQ,QAAUC,EAAc,EACnCT,EACE,KACA,CAAE,MAAO,UAAW,EACpBQ,EAAQ,IAAKI,GAAW,CACtBZ,EACE,KACA,CACE,MAAO,CACL,WACA,CAAE,OAAQa,EAAaH,EAAO,IAAIE,EAAO,MAAM,CAAE,CACnD,CACF,EACAV,EAAaU,CAAM,CACrB,EACAL,EAAeK,EAAO,SAAUH,EAAc,CAAC,CACjD,CAAC,CACH,EACA,IACN,EAEA,IAAed,EAAAA,EAAgB,CAC7B,KAAM,MAEN,MAAO,CAML,MAAO,CACL,KAAM,MACN,QAAS,IAAM,CACjB,CAAA,EAOA,YAAa,CACX,KAAM,OACN,QAAS,CACX,CACF,EAEA,MAAMmB,EAAO,CAAE,MAAAC,CAAM,EAAG,CACtB,MAAML,EAAQC,EAAS,EACjBK,EAAOC,EAAY,EACnBC,EAAaC,EAAc,EAC3BC,EAAMC,EAAAA,EAENC,EAAYC,GAAsB,CAtF5C,IAAAC,GAuFMA,EAAAJ,EAAI,QAAJ,MAAAI,EAAW,SAAS,CAAE,IAAAD,EAAK,SAAU,QAAS,CAChD,CAAA,EAEA,OAAAE,EAAU,IAAM,CAEdC,EACE,IAAMhB,EAAM,KACXiB,GAAe,CACd,GAAIP,EAAI,MAAO,CAEb,MAAMQ,EAAgB,SAAS,cAC7B,0BAA0BD,KAC5B,EAEA,GAAI,CAACC,EAAe,OAGpB,KAAM,CAAE,IAAKC,EAAQ,OAAQC,CAAU,EACrCV,EAAI,MAAM,wBAEN,CAAE,IAAKW,EAAkB,OAAQC,CAAoB,EACzDJ,EAAc,sBAAsB,EAGlCG,EAAmBF,EAErBP,EAASF,EAAI,MAAM,UAAYW,EAAmBF,CAAM,EAGxDE,EAAmBC,EACnBH,EAASC,GAGTR,EACEF,EAAI,MAAM,UACRW,EACAC,EACAH,EACAC,CACJ,EAEN,CACF,CACF,CAAC,EAEM,IAAoB,CApI/B,IAAAN,EAAAS,EAqIM,MAAMC,EAAapB,EAAM,MAAM,OAC3BP,EAAeO,EAAM,MAAOA,EAAM,WAAW,EAC7CE,EAAK,MAAM,QACXT,EAAeS,EAAK,MAAM,QAASF,EAAM,WAAW,EACpD,KAEJ,OAAOoB,EACHlC,EAAE,MAAO,CAAE,MAAO,kBAAmB,EAAG,CACtCA,EAAE,QAAS,CAAE,GAAI,KAAM,EAAG,EACxBwB,EAAAT,EAAM,SAAN,KAAAS,OAAAA,EAAA,KAAAT,CAAAA,EACAf,EAAE,MAAO,CAAE,MAAO,YAAa,EAAG,CAChCkB,EAAW,MAAM,IACjBlB,EAAEmC,CAAW,CACf,CAAC,EACDnC,EAAE,MAAO,CAAE,MAAO,cAAe,IAAKoB,CAAI,EAAGc,CAAU,GACvDD,EAAAlB,EAAM,QAAN,KAAAkB,OAAAA,EAAA,KAAAlB,CAAAA,CACF,CAAC,CACH,CAAC,EACD,IACN,CACF,CACF,CAAC"}